(function(){var a;a=angular.module("app",["ui.router","ui.bootstrap","hmTouchEvents","angularSpinner"]),a.config(["$stateProvider","$urlRouterProvider",function(a,b){return console.log("config1"),b.when("/article/{article}/page/{page}/token/{token}",["$rootScope","$state","$match","notesService",function(a,b,c,d){return a.token=c.token,d.setToken(c.token),"/article/"+c.article+"/page/"+c.page}]).when("/a{article}p{page}",["$state","$match",function(a,b){return"/article/"+b.article+"/page/"+b.page}]).when("/article/{article}/page/{page}/favoritetoken/{favoritetoken}",["$rootScope","$state","$match","favoriteService",function(a,b,c,d){return d.setToken(c.favoritetoken),"/article/"+c.article+"/page/"+c.page}]).when("/article/{article}/page/{page}/keyword/{keyword}",["$rootScope","$state","$match",function(a,b,c){return a.keyword=c.keyword,"/article/"+c.article+"/page/"+c.page}]).when("/article/{article}/page/{page}/modal/{modal}",["$rootScope","$state","$match",function(a,b,c){return a.modalString=c.modal,"/article/"+c.article+"/page/"+c.page}]).when("/mag/{magazine}/issue/{issue}",["$rootScope","$state","$match",function(a,b,c){return"/mag/"+c.magazine+"/issue/"+c.issue}]).otherwise(function(){var a,b,c,d,e,f;if("undefined"!=typeof Storage&&Content.savePageNumber)try{d=localStorage.getItem("currentPosition")}catch(g){a=g,d=void 0}if(!d)return"/article/1/page/1";try{return c=JSON.parse(d),e=window.location.protocol+"//"+window.location.host+window.location.pathname,c.url===e?(b="/article/"+c.current.article+"/page/"+c.current.page,(null!=(f=c.spread)?f.page:void 0)&&(b+="-"+c.spread.page),b):"/article/1/page/1"}catch(g){return a=g,"/article/1/page/1"}}),a.state("articles",{url:"/article/:article/page/:page",templateUrl:"views/articles.html",controller:"articles"})}]),a.config(["$urlRouterProvider",function(a){return console.log("config"),a.deferIntercept()}]),a.run(["$rootScope","$urlRouter","$state","PagePosition","PublicationContent",function(a,b,c,d,e){return console.log("APPRUN"),FastClick.attach(document.body),document.title=e.pageTitle,a.$on("$locationChangeSuccess",function(e,f,g,h){var i,j,k;return e.preventDefault(),a.noReload?a.noReload=!1:"articles"===c.current.name?(i=/\#(.*)/.exec(f),i&&(k=c.$current.url.exec(i[1])),k?(j=k.page.split("-"),1===j.length?d.flipPage(parseInt(k.article,10),parseInt(j[0],10)):d.flipPage(parseInt(k.article,10),parseInt(j[0],10),parseInt(j[1],10))):b.sync()):b.sync()}),b.listen()}])}).call(this),angular.module("app").run(["$templateCache",function(a){"use strict";a.put("views/actionpoints.html",'<show-video\r\n     class="actionpoint video inline"\r\n     data="actionpoint"\r\n     video="actionpoint.sources[0]"\r\n     ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n     ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n     ng-if="actionpoint.type == \'video\' && actionpoint.appearance == \'inline\'"\r\n     ></show-video>\r\n\r\n<inline-carousel\r\n     class="actionpoint image inline"\r\n     actionpoint="actionpoint"\r\n     ng-class="{flash: hover, show: $root.actionpointsVisible, slideshow: actionpoint.sources.length > 1}"\r\n     ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n     ng-if="actionpoint.type == \'image\' && actionpoint.appearance == \'inline\'"\r\n     ></inline-carousel>\r\n\r\n<show-html-page\r\n     class="actionpoint html inline"\r\n     data="actionpoint"\r\n     ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n     ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n     ng-if="actionpoint.type == \'link\' && actionpoint.appearance == \'inline\'"\r\n     ></show-html-page>\r\n\r\n<read-text\r\n     class="actionpoint text inline"\r\n     actionpoint="actionpoint"\r\n     ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n     ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n     ng-if="actionpoint.type == \'text\' && actionpoint.appearance == \'inline\'"\r\n     ></read-text>\r\n\r\n<a\r\n     content-link\r\n     class="actionpoint video hotspot"\r\n     data="actionpoint"\r\n     ng-click="openVideoModal(actionpoint)"\r\n     ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n     ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n     ng-if="actionpoint.type == \'video\' && actionpoint.appearance == \'popup\' && !$root.disablePopups"\r\n     ></a>\r\n\r\n<a\r\n    content-link\r\n    class="actionpoint video hotspot"\r\n    data="actionpoint"\r\n    ng-init="openVideoModal(actionpoint)"\r\n    ng-click="openVideoModal(actionpoint)"\r\n    ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n    ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n    ng-if="actionpoint.type == \'video\' && actionpoint.appearance == \'autopopup\'"\r\n    ></a>\r\n\r\n<a\r\n    content-link\r\n    class="actionpoint audio hotspot"\r\n    data="actionpoint"\r\n    ng-click="openAudioPlayer(actionpoint)"\r\n    ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n    ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n    ng-if="actionpoint.type == \'audio\' && actionpoint.appearance == \'overLay\'"\r\n    ></a>\r\n\r\n    <a\r\n        content-link\r\n        class="actionpoint audio hotspot"\r\n        data="actionpoint"\r\n        ng-init="openAudioPlayer(actionpoint)"\r\n        ng-click="openAudioPlayer(actionpoint)"\r\n        ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n        ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n        ng-if="actionpoint.type == \'audio\' && actionpoint.appearance == \'autoaudio\'"\r\n        ></a>\r\n<a\r\n     content-link\r\n     class="actionpoint image hotspot"\r\n     data="actionpoint"\r\n     ng-mousedown="preventDragging($event)"\r\n     ng-click="openPictureModal(actionpoint)"\r\n     ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n     ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n     ng-if="actionpoint.type == \'image\' && actionpoint.appearance == \'popup\' && !$root.disablePopups"\r\n     ></a>\r\n<a\r\n     content-link\r\n     class="actionpoint image hotspot"\r\n     data="actionpoint"\r\n     ng-init="openPictureModal(actionpoint)"\r\n     ng-click="openPictureModal(actionpoint)"\r\n     ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n     ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n     ng-if="actionpoint.type == \'image\' && actionpoint.appearance == \'autopopup\'"\r\n     ></a>\r\n<a\r\n     content-link\r\n     class="actionpoint text hotspot"\r\n     data="actionpoint"\r\n     ng-click="openTextModal(actionpoint)"\r\n     ng-mousedown="preventDragging($event)"\r\n     ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n     ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n     ng-if="actionpoint.type == \'text\' && actionpoint.appearance == \'popup\' && !$root.disablePopups"\r\n     ></a>\r\n\r\n <a\r\n      content-link\r\n      class="actionpoint text hotspot"\r\n      data="actionpoint"\r\n      ng-init="openTextModal(actionpoint)"\r\n      ng-click="openTextModal(actionpoint)"\r\n      ng-mousedown="preventDragging($event)"\r\n      ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n      ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n      ng-if="actionpoint.type == \'text\' && actionpoint.sources[0].split(\'/\')[2] + actionpoint.dimensions[0] + \'\' + actionpoint.dimensions[1] + \'\' + actionpoint.dimensions[2] + \'\' + actionpoint.dimensions[3] == $root.modalString"\r\n      ></a>\r\n <a\r\n      content-link\r\n      class="actionpoint iframe hotspot"\r\n      data="actionpoint"\r\n      ng-click="openIframeModal(actionpoint)"\r\n      ng-mousedown="preventDragging($event)"\r\n      ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n      ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n      ng-if="actionpoint.type == \'iframe\' && actionpoint.appearance == \'popup\' && !$root.disablePopups"\r\n      ></a>\r\n<a\r\n    content-link\r\n    class="actionpoint image hotspot shop"\r\n    data="actionpoint"\r\n    ng-click="openShopModal(actionpoint)"\r\n    ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n    ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n    ng-if="actionpoint.type == \'shop\' && actionpoint.appearance == \'popup\' && !$root.disablePopups"\r\n    ></a>\r\n<a\r\n     content-link\r\n     class="actionpoint link"\r\n     data="actionpoint"\r\n     href="{{actionpoint.url}}"\r\n     target="{{actionpoint.target}}"\r\n     title="{{actionpoint.url}}"\r\n     ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n     ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n     ng-if="actionpoint.type == \'a\'"\r\n     ></a>\r\n'),a.put("views/articles.html",'<div class="nav-wrapper">\r\n  <div class="actionbar" id="topbar" ng-click="toggleNavbar($event)">\r\n    <div style="" class="nav-buttons" id="nav-section-1">\r\n      <span  ng-if="view.isNativeApp"><button class="btn btn-sm backButton" ng-click="callObjectiveC(\'dismissReader\')">Takaisin</button></span>\r\n        <span id="pageIndicator">{{txtPage}}: {{ current.article }}{{ spread.article ? \'-\' + spread.article : \'\' }} / {{ content.articles.length }}</span>\r\n        <span id="subPageIndicator">Sub page: {{ current.page }}{{ spread.article ? \' | \' + spread.page : \'\' }}</span>\r\n        <span ng-hide="!content.searchable"><input type="text" id="searchField" ng-model = "searchField" value="{{ searchText }}" ng-change="search($event)" ng-click="noAction($event)" ng-focus="searchStart($event)" ng-blur="searchBlur()"/></span>\r\n    </div>\r\n    <div style="" class="nav-buttons" id="nav-section-2">\r\n\r\n\r\n    </div>\r\n    <div style="" class="nav-buttons pull-right" id="nav-section-3" ng-click="noAction($event)">\r\n      \r\n        <div class="share-buttons">\r\n          <button ng-if="showShareButtons"\r\n            id="facebook-btn-topbar"\r\n            ng-click="shareSpread($event, \'fb\')"\r\n            class="btn btn-sm"\r\n            >\r\n            <i class="fa fa-facebook"></i>\r\n          </button>\r\n\r\n          <button ng-if="showShareButtons"\r\n            id="facebook-btn-topbar"\r\n            ng-click="shareSpread($event, \'twitter\')"\r\n            class="btn btn-sm"\r\n            >\r\n            <i class="fa fa-twitter"></i>\r\n          </button>\r\n\r\n          <button ng-if="showShareButtons"\r\n            id="facebook-btn-topbar"\r\n            ng-click="shareSpread($event, \'link\')"\r\n            class="btn btn-sm"\r\n            >\r\n            <i class="fa fa-link"></i>\r\n          </button>\r\n          <button ng-if="showShareButtons"\r\n          id="facebook-btn-topbar"\r\n          ng-click="shareSpread($event, \'linkedin\')"\r\n          class="btn btn-sm"\r\n          >\r\n          <i class="fa fa-linkedin"></i>\r\n          </button>\r\n        </div>\r\n        <button ng-if="content.enableSpreadSharing"\r\n                ng-click="toggleShareButtons()"\r\n                class="btn btn-sm"\r\n                title="share">\r\n          <i class="fa fa-share-alt"></i>\r\n        </button>\r\n\r\n        <button\r\n                ng-if="content.favoritePhrases"\r\n                ng-click="toggleFavorites()"\r\n                class="btn btn-sm"\r\n                title="share"\r\n                id="favorite-button">\r\n          <i class="fa fa-star"></i>\r\n        </button>\r\n      \r\n      <div id="menu-zoomer" ng-show="MenuZoomSlider && !view.isMobile">\r\n        <div id="menuzoompanel" style="">\r\n          <input ng-show="!view.isMobile" type="range" min="{{content.minZoom}}" max="{{content.maxZoom}}" step="0.1" ng-model="zoomRange" ng-change="setRangeZoom()">\r\n        </div>\r\n      </div>\r\n\r\n      <span id="actionbar-zoomslider">\r\n        <input id="actionbar-zoom" ng-show="!view.isMobile" type="range" min="{{content.minZoom}}" max="{{content.maxZoom}}" step="0.1" value="1" ng-model="zoomRange" ng-change="setRangeZoom()">\r\n      </span>\r\n      <button ng-if="view.hideAudioPlayer" ng-click="unhideAudioPlayer($event)"\r\n              class="btn btn-sm"\r\n              id="audio-button"\r\n              title="">\r\n        <i class="fa fa-music"></i>\r\n      </button>\r\n      <button ng-click="onDoubleTap($event)"\r\n              class="btn btn-sm"\r\n              id="zoomButton"\r\n              title="{{txtToggleZoom}}">\r\n        <i class="fa" ng-class="{\'fa-search-plus\': !view.zoomEnabled, \'fa-search-minus\': view.zoomEnabled}"></i>\r\n      </button>\r\n\r\n      <button ng-if="hasFullscreen()"\r\n              ng-click="toggleFullscreen($event)"\r\n              class="btn btn-sm"\r\n              id="fullscreenButton"\r\n              title="Toggle fullscreen mode">\r\n        <i class="fa fa-arrows-alt"></i>\r\n      </button>\r\n      <button ng-if="!view.spreadEnabled" ng-click="toggleSpread($event)"\r\n              class="btn btn-sm"\r\n              id="spreadButton"\r\n              title="{{txtToggleSpread}}">\r\n        <i class="fa fa-file-o flip-x"></i>\r\n        <i class="fa fa-file-o"></i>\r\n      </button>\r\n      <button ng-if="view.spreadEnabled" ng-click="toggleSpread($event)"\r\n              class="btn btn-sm"\r\n              id="spreadButton"\r\n              title="{{txtTogglePage}}">\r\n        <i class="fa fa-file-o"></i>\r\n      </button>\r\n      <button ng-if="content.shop" ng-click="cart()"\r\n              class="btn btn-sm {{view.cartButtonClass}}"\r\n              ng-class={{view.cartButtonClass}}\r\n              id="shopButton"\r\n              title="{{txtCart}}">\r\n      <i class="fa fa-shopping-cart"></i>\r\n      </button>\r\n      <button ng-if="!$root.disablePopups" ng-click="$root.disablePopups=true"\r\n              class="btn btn-sm"\r\n              id="disable-actions"\r\n              title="{{txtDisableActions}}">\r\n        <i class="fa fa-bolt"></i>\r\n      </button>\r\n      <button ng-if="$root.disablePopups" ng-click="$root.disablePopups=false"\r\n              class="btn btn-sm"\r\n              id="enable-actions"\r\n              title="{{txtDisableActions}}">\r\n        <i class="fa fa-bolt" style="opacity: 0.2;"></i>\r\n      </button>\r\n\r\n      <button ng-click="toggleActionpoints($event)"\r\n              class="btn btn-sm"\r\n              id="actionpointButton"\r\n              title="{{txtHighlightActionpoints}}">\r\n        <i class="fa fa-lightbulb-o"></i>\r\n      </button>\r\n      <button ng-if="content.printable && !view.isMobile" ng-click="print()"\r\n              class="btn btn-sm"\r\n              id="printButton"\r\n              title="{{txtPrint}}">\r\n        <i class="fa fa-print"></i>\r\n      </button>\r\n      <button ng-click="help()"\r\n              class="btn btn-sm"\r\n              id="help-button"\r\n              title="{{txtHelp}}">\r\n        <i class="fa fa-question-circle"></i>\r\n      </button>\r\n      <button ng-click="navWindow()"\r\n              class="btn btn-sm"\r\n              id="nav-button"\r\n              title="{{txtTableOfContents}}">\r\n        <i class="fa fa-th"></i>\r\n      </button>\r\n      <button ng-click="toggleNavbar($event)"\r\n              class="btn btn-sm"\r\n              id="thumbButton"\r\n              title="{{txtToggleNavigation}}">\r\n        <i class="fa fa-th"></i>\r\n      </button>\r\n      <button ng-if="notesPanel" ng-click="toggleNotes()"\r\n              class="btn btn-sm"\r\n              id="notesButton"\r\n              title="{{txtTogglePage}}">\r\n        <i class="fa fa-comment"></i>\r\n      </button>\r\n    </div>\r\n  </div>\r\n  <navbar class="nav"\r\n    ng-if="$root.isNavbarVisible"\r\n    >\r\n  </navbar>\r\n  <search-results ng-if="$root.isSearchVisible">\r\n  </search-results>\r\n</div>\r\n\r\n<div class="arrows" ng-if="!$root.isNavbarVisible">\r\n  <!-- article navigation -->\r\n  <a\r\n    class="arrow arrow-left"\r\n    ng-if="current.article > 1"\r\n    ng-click="article.prev(true)"><i class="fa fa-chevron-left"></i></a>\r\n\r\n  <a\r\n    class="arrow arrow-right"\r\n    ng-if="showRightArrow"\r\n    ng-click="article.next(true)"><i class="fa fa-chevron-right"></i></a>\r\n\r\n  <!-- page navigation -->\r\n  <a\r\n    class="arrow arrow-up"\r\n    ng-class="view.spreadEnabled ? \'left\' : \'\'"\r\n    ng-if="current.page > 1"\r\n    ng-click="page.prev()"><i class="fa fa-chevron-up"></i></a>\r\n\r\n  <a\r\n    class="arrow arrow-down"\r\n    ng-class="view.spreadEnabled ? \'left\' : \'\'"\r\n    ng-if="current.page < selectedArticle.length"\r\n    ng-click="page.next()"><i class="fa fa-chevron-down"></i></a>\r\n\r\n  <!-- spread page navigation -->\r\n  <div ng-if="view.spreadEnabled && spread.article">\r\n    <a\r\n      class="arrow arrow-up right"\r\n      ng-if="spread.page > 1"\r\n      ng-click="spreadPage.prev()"><i class="fa fa-chevron-up"></i></a>\r\n\r\n    <a\r\n      class="arrow arrow-down right"\r\n      ng-if="spread.page < spreadArticle.length"\r\n      ng-click="spreadPage.next()"><i class="fa fa-chevron-down"></i></a>\r\n  </div>\r\n</div>\r\n<!-- <div zoom-area class="main-content"\r\n     hm-manager-options=\'{"touchAction": "auto"}\'\r\n     hm-tap="onSingleTap($event)"\r\n     hm-doubletap="onDoubleTap($event)"\r\n     hm-pinchstart="onPinchStart($event)"\r\n     hm-pinchmove="onPinch($event)"\r\n     hm-pinchend="onPinchEnd($event)"\r\n     ng-mousemove="mouseMoved($event)"\r\n     hm-panstart="dragStart($event)"\r\n     hm-panmove="drag($event)"\r\n     hm-panend="dragEnd($event)"\r\n\r\n\r\n<div zoom-area class="main-content"\r\n     hm-manager-options=\'{"touchAction": "auto"}\'\r\n     hm-tap="onSingleTap($event)"\r\n     hm-doubletap="onDoubleTap($event)"\r\n     hm-pinchstart="onPinchStart($event)"\r\n     hm-pinchmove="onPinch($event)"\r\n     hm-pinchend="onPinchEnd($event)"\r\n     ng-mousemove="mouseMoved($event)"\r\n     hm-panstart="dragStart($event)"\r\n     hm-panmove="drag($event)"\r\n     hm-panend="dragEnd($event)"\r\n     >\r\n     > -->\r\n     <div zoom-area class="main-content"\r\n          hm-manager-options=\'{"touchAction": "auto"}\'\r\n          hm-tap="onSingleTap($event)"\r\n          hm-doubletap="onDoubleTap($event)"\r\n          hm-pinchstart="onPinchStart($event)"\r\n          hm-pinchmove="onPinch($event)"\r\n          hm-pinchend="onPinchEnd($event)"\r\n          hm-pinchcancel="onPinchEnd($event)"\r\n          ng-mousemove="mouseMoved($event)"\r\n          hm-panstart="dragStart($event)"\r\n          hm-panmove="drag($event)"\r\n          hm-panend="dragEnd($event)"\r\n          >\r\n\r\n  <div class="articles-wrapper" styles="-webkit-user-select: none; user-select: none;-webkit-user-drag: none; user-drag: none;">\r\n\r\n    <articles ng-class="{dragging: dragging}" styles="-webkit-user-select: none; user-select: none;">\r\n      <spread styles="-webkit-user-select: none; user-select: none;-webkit-user-drag: none; user-drag: none;" ng-repeat="spread in content.spreads" index="$index" ng-class=\'{"two-page": view.spreadEnabled, "one-page": !view.spreadEnabled, "active-spread": spread.active}\' ng-if="spread.active">\r\n        <pages ng-repeat="article in spread.articles" article="article" class="{{article.type}}" ng-class="{dragging: dragging}">\r\n          <page\r\n            ng-if="page.active"\r\n            ng-show="!view.zoomEnabled || isCurrent(page)"\r\n            ng-class = \'{"current-page": isCurrent(page)}\'\r\n            page="page"\r\n            ng-repeat="page in article.pages"\r\n            >\r\n          </page>\r\n        </pages>\r\n      </spread>\r\n    </articles>\r\n\r\n  </div>\r\n  <div class="zoomer" ng-mouseleave="toggleZoomSlider(false)">\r\n    <input type="range" min="0.5" max="6" step="0.1" ng-model = "zoomLevel" ng-change="setRangeZoom()">\r\n  </div>\r\n</div>\r\n<notes-panel ng-if="notesPanel && !notesPanelHidden"></notes-panel>\r\n<div ng-if="view.showAudioPlayer" ng-show="!view.hideAudioPlayer" style="position: absolute; top:0; width: 100%; height:300px; text-align:center;">\r\n  <audio-player></audio-player>\r\n</div>\r\n<div ng-if="view.showFavoriteModal" ng-show="true" style="position: absolute; top:0; width: 100%; height:300px;">\r\n  <favorites-modal></favorites-modal>\r\n</div>\r\n<div hm-panmove="adDrag($event)" hm-pinchstart="adDrag($event)" class="ad-placeholder" ng-show="showPageAdsOnPage" ng-style="adPlaceHolderStyle" ng-click="showPageAdsOnPage = false" style="">\r\n  <div class="close-ad-btn" ng-click="showPageAdsOnPage = false">{{txtCloseAd}} <span class="fa fa-times"></span></div>\r\n  <div ng-if="showSmartAds" ng-repeat="x in ads" class="ad-inner" id="sas_{{x.adid}}" ng-show = "x.adid == showAdId" ng-click="$event.stopPropagation()" ng-style="adInnerStyle" style="">\r\n  </div>\r\n  <div ng-if="showFileAds" ng-repeat="x in ads" class="ad-inner" id="file_{{x.adid}}" ng-show = "x.adid == showAdId" ng-click="$event.stopPropagation()" ng-style="adInnerStyle" style="">\r\n    <a ng-href="{{x.url}}" target="_blank"><img ng-src="{{pageAdsUrl}}/{{x.adid}}" width="200" height="200"></a>\r\n  </div>\r\n  <div ng-if="showK360Ads" ng-repeat="x in ads" class="ad-inner" id="file_{{x.image._1200}}" ng-show = "x.adid == showAdId" ng-click="$event.stopPropagation()" ng-style="adInnerStyle" style="">\r\n    <a ng-href="{{x.url}}" target="_blank"><img ng-src="{{x.image._1200}}" width="200" height="200"></a>\r\n  </div>\r\n</div>\r\n'),a.put("views/audio-player.html",'\r\n<div style="padding: 20px; background-color: rgba(0,0,0,0.7); width:100%; max-width:600px; text-align:center; margin:{{playerTopMargin + \'px\'}} auto 0 auto">\r\n	<table style="width:100%;color:#fff">\r\n		<tr>\r\n			<td colspan="3"><h2>{{heading1}}</h2></td>\r\n\r\n		</tr>\r\n		<tr>\r\n			<td><span style="cursor:pointer" ng-click="hideAudioPlayer()"><span style="font-size:2em;"<i class="fa fa-arrow-circle-up"></i></span><br />Piilota</span></td>\r\n			<td>	<audio  style="" controls loop autoplay webkitallowfullscreen mozallowfullscreen allowfullscreen>\r\n					<source></source>\r\n					<p>Your browser does not support HTML5 audio</p>\r\n				</audio></td>\r\n			<td><span style="text-align:center; cursor:pointer;" ng-click="closeAudioPlayer()"><span style="font-size:2em;"><i class="fa fa-times-circle"></i></span><br />Sulje</span></td>\r\n		</tr>\r\n		<tr>\r\n			<td colspan="3">\r\n				<h3>{{heading2}}</h3>\r\n			</td>\r\n		</tr>\r\n	</table>\r\n\r\n\r\n</div>\r\n'),a.put("views/favorites-modal.html",'<div style="height: {{readerHeight + \'px\'}}; background-color: rgba(0,0,0,0.6);">\r\n	&nbsp;\r\n	<div class="favorite-modal" style="margin:{{ModalTopMargin + 10 + \'px\'}} auto 0 auto;">\r\n		\r\n		<div class="favorite-headers" style="position:relative">\r\n			<h2 style="text-align:center;">{{heading1}}</h2>\r\n			<div ng-repeat="item in myFavoriteItems track by $index" style="font-size:0.7em; background-color: rgb(134 229 247); color: #666; border-radius: 8px; float:left; margin: 5px; padding: 2px 8px 2px 8px;">\r\n				{{ item.name }}\r\n			</div>\r\n			<div style="clear:both;height:10px;"></div>\r\n			<div style="text-align:right; position:absolute; top: 0px; width:100%; color:#fff;" ng-click="closeFavoriteModal()"><span style="font-size:2em;"><i class="fa fa-times-circle"></i></div>\r\n		</div>\r\n\r\n		<div class="favorite-info-wrapper" style="padding:1%; background-color: #86e5f7;" ng-if="notesLoggedIn">\r\n			<div style="text-align:left; font-size:0.8em; margin-bottom:5px;">Suosikkihevosesi esiintyy tässä julkaisussa seuraavasti:</div>\r\n			<table style="width:100%">\r\n				<tr ng-repeat="item in favoriteMatches track by $index">\r\n					<td><span style="font-weight:bold;"><i class="fa fa-star"></i> {{ item.phrase }}</span></td><td>SIVU {{item.page}}</td>\r\n					<td style="width:60px;">\r\n						<div style="margin:5px; position:relative">\r\n							<img ng-click="jumpToFavoriteDestination(item.page*1)" ng-src="{{articles[item.page-1].pages[0].thumbnail_url}}" style="width:50px;border: 1px solid; cursor:pointer;"/>\r\n							<span class="favorite-sign" style="position:absolute; left:{{item.x}}%; top:{{ 95 - item.y}}%;"><i class="fa fa-star"></i></span>\r\n						</div>\r\n					</td>\r\n				</tr>\r\n			</table>\r\n			<div style="clear:both;"></div>\r\n		</div>\r\n		<div class="favorite-info-wrapper" style="padding:1%; background-color: #86e5f7;" ng-if="!notesLoggedIn">\r\n			<div style="text-align:left; font-size:0.8em; margin-bottom:5px; text-align:center;">Emme voi näyttää suosikkihevosiasi, koska et ole kirjautunut.</div>\r\n			<div style="text-align:left; font-size:0.8em; margin-bottom:5px; text-align:center;"><button ng-click="login()">Kirjaudu</button></div>\r\n		</div>\r\n		<div style="margin:5px 0 5px 0; font-size: 0.8em" ng-if="notesLoggedIn">\r\n			<span style="cursor: pointer;" ng-click="toggleFavoriteSelections()"><i class="fa fa-cog"></i> Muokkaa suosikkihevosiasi</span>\r\n		</div>\r\n		<div ng-if="showFavoriteSelections" class="favorite-select-wrapper" style="padding:1%; background-color: #eee;">\r\n			<div style="float:left; width:46%; margin:1%; padding:1%; background-color: #fff;">\r\n				<div ng-repeat="item in unselectedFavoriteItems track by $index">\r\n					<div ng-click="selectPhrase()" class="favorite-phrase">{{ item.name }}</div>\r\n				</div>\r\n			</div>\r\n			<div style="float:left; width:46%; margin:1%; padding:1%; background-color: #fff;">\r\n				<div ng-repeat="item in myFavoriteItems track by $index">\r\n					<div ng-click="deSelectPhrase()" class="favorite-phrase">{{ item.name }}</div>\r\n				</div>\r\n			</div>\r\n			<div style="clear:both;"></div>\r\n		</div>\r\n\r\n	</div>\r\n</div>\r\n'),a.put("views/help-modal.html",'<div class="modal-body no-padding" style="height:{{readerHeight}}px;">\r\n  <button ng-if="!actionpoint.caption" type="button" ng-click="close()" class="close positioned">\r\n    <span class="close-icon" aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\r\n  <div ng-bind-html="htmlContent | trustHtml"></div>\r\n</div>\r\n'),a.put("views/iframe-modal.html",'<iframe style="width:100%; height: {{iframeHeight}}; min-height:600px;" ng-src="{{iframeUrl}}" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen allowautoplay allow="autoplay; fullscreen; picture-in-picture; xr-spatial-tracking; encrypted-media">\r\n\r\n</iframe>\r\n'),a.put("views/inline-carousel.html",'\r\n<carousel disable-ng-animate interval="interval">\r\n  <slide ng-repeat="picture in actionpoint.sources">\r\n    <show-picture picture="picture" actionpoint="actionpoint"></show-picture>\r\n  </slide>\r\n</carousel>\r\n'),a.put("views/main.html",'<div ui-view ng-class="direction" class="ui-view-articles"></div>\r\n'),a.put("views/nav-modal.html",'<div class="modal-body no-padding" style="height:{{readerHeight}}px;">\r\n\r\n  <div class="nav-modal-header"><h2>{{navTitle}}</h2></div>\r\n    <button ng-if="!actionpoint.caption" type="button" ng-click="close()" class="close positioned"><span class="close-icon" aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\r\n    <div ng-repeat = "article in content.articles" class="nav-modal-page" ng-click="navTo($index+1)">\r\n    <div class="nav-modal-page-header" style="">{{pageWord}} {{$index+1}}</div>\r\n    <div style="width:30%;float:left;text-align:left;padding:10px;">\r\n\r\n      <img ng-src="{{article[0].thumbnail_url}}" style="max-width:100%;box-shadow: 2px 2px 5px">\r\n    </div>\r\n    <div style="width:70%;float:left;padding:10px;">\r\n      <div ng-repeat="titles in contentParagraphs | filter:headingFilter">\r\n        <p ng-if = "titles.page == $parent.$index+1" style="font-weight:bold;">{{titles.text}}</p>\r\n      </div>\r\n    </div>\r\n    <div style="clear:both;"></div>\r\n  </div>\r\n</div>\r\n'),a.put("views/navbar.html",'<div class="navigation"\r\n     ng-class="hasSubPages ? \'sub-pages\' : \'\'"\r\n     >\r\n  <div class="nav-item-article"\r\n       ng-repeat="article in articles"\r\n       ng-class="{\'current-article\': article.index == current.article, \'two-page\': view.spreadEnabled, \'one-page\': !view.spreadEnabled}"\r\n       >\r\n    <navbar-page page="article.pages[0]"></navbar-page>\r\n    <div class="navbar-subpages">\r\n      <navbar-page page="page"\r\n        ng-repeat="page in article.pages.slice(1)"\r\n        ></navbar-page>\r\n    </div>\r\n\r\n  </div>\r\n</div>\r\n'),a.put("views/navbar_page.html",'<div\r\n  class="nav-item-page"\r\n  ng-class="{\'current-page\': isCurrentOrSpread(), main: page.index==1, sub: page.index!=1}"\r\n  >\r\n  <div\r\n     class="page-title"\r\n     ng-if="page.index==1"\r\n     ng-click="jumpToPage(page.article.index, page.index)"\r\n     >\r\n    {{page.article.title}}\r\n  </div>\r\n  <div class="page-thumb"\r\n       title="{{titleAttribute(page.article.title, page.article.index, page.index)}}"\r\n       >\r\n    <img\r\n      ng-click="jumpToPage(page.article.index, page.index)"\r\n      ng-src="{{page.thumbnail_url}}"\r\n      />\r\n    <span class="page-number" ng-if="page.index==1">{{page.article.index}}</span>\r\n  </div>\r\n</div>\r\n'),a.put("views/note-modal.html",'<div class="modal-body no-padding shop-modal" style="height:{{readerHeight}}px;">\r\n  <div class="popup-header">\r\n    <button ng-if="!actionpoint.caption" type="button" ng-click="close()" class="close positioned"><span class="close-icon" aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\r\n    <h1>{{txtNoteFormHeader}}</h1>\r\n  </div>\r\n  <div class="notes-body">\r\n    <div class="notes-info" style="width:90%;margin: 20px auto 0 auto;">\r\n        <div ng-if="noteSpreadPage" style="font-size:1.4em;">\r\n          <i class="fa fa-file flip-x" ng-style="{ color: selectedPage == notePage ? \'#666\' : \'#bbb\' }" ng-click = "setSelectedPage(notePage)"></i><i class="fa fa-file" ng-style="{ color: selectedPage == noteSpreadPage ? \'#666\' : \'#bbb\' }" ng-click = "setSelectedPage(noteSpreadPage)"></i>\r\n          {{selectedPage}}\r\n        </div>\r\n    </div>\r\n    <form>\r\n      <div style="display:block;margin-left:35px;">\r\n        <div style="float:left;font-size:12px;    padding-top: 8px;">Väri:</div>\r\n        <div class="notes-style-button-1 notestyle" ng-class="{\'selected-note-style\':selectedStyle == 1}" ng-click="selectNoteStyle(1)"></div>\r\n        <div class="notes-style-button-2 notestyle" ng-class="{\'selected-note-style\':selectedStyle == 2}" ng-click="selectNoteStyle(2)"></div>\r\n        <div class="notes-style-button-3 notestyle" ng-class="{\'selected-note-style\':selectedStyle == 3}" ng-click="selectNoteStyle(3)"></div>\r\n        <div class="notes-style-button-4 notestyle" ng-class="{\'selected-note-style\':selectedStyle == 4}" ng-click="selectNoteStyle(4)"></div>\r\n        <div style="clear:both;"></div>\r\n      </div>\r\n      <textarea class="notes-textarea" ng-model="noteArea" name="note-text" rows="8" cols="80"></textarea>\r\n      <br>\r\n      <div style="text-align:right; width:90%;height:40px;margin: 0 auto 0 auto;">\r\n        <button ng-click="close()">Peruuta</button> <button ng-click="saveNote()">Tallenna</button>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</div>\r\n'),a.put("views/notes-panel.html",'<div id="notes-panel" ng-style = "notesPanelStyle">\r\n  <div class="notes-panel-header" style="position:relative;border-bottom: 1px solid #000;">\r\n    <i style="" ng-if="(userNotes|filter:{page:current.article || note.page == spread.article}).length>0 && !notesPanelOnStage" class="fa fa-comment note-indicator"></i>\r\n    <span ng-click="toggleNotePanel()" class="" style="font-size:24px;position:relative;display: inline-block; transition:1s; font-weight:bold;" ng-style = "notesPanelArrowStyle">&raquo;</span>\r\n    <span ng-if="notesPanelOnStage">| {{txtNotePanelHeading}}</span>\r\n    <span ng-click="toggleNotes()" style="font-size:24px;position:absolute;right:0px;top:5px" class="fa fa-times"></span>\r\n  </div>\r\n  <div class="notes-toolbar" ng-if="!signedOut">\r\n    <button style="font-size:24px;" type="image" src="images/rectnote.png" ng-click="rectangleTool()"\r\n            class=""\r\n            id="note-rectangle"\r\n            title="uusi merkintä">\r\n      <i class="fa fa-edit"></i>\r\n    </button>\r\n\r\n\r\n    <button style="font-size:24px;" ng-click="pageNote(current.article, spread.article)"\r\n            class=""\r\n            id="note-text"\r\n            title="uusi muistiinpano">\r\n      <i class="fa fa-comment"></i>\r\n    </button>\r\n  </div>\r\n\r\n  <div id="notes-login" ng-show="notesPanelOnStage && signedOut">\r\n    <p class="notes-disclaimer">{{txtNotesNotLoggedIn}}</p>\r\n    <form>\r\n      <input type="text" ng-model = "notesEmail" ng-focus="notesLoginStart($event)"><br>\r\n      <input type="password" ng-model = "notesPassword" ng-focus="notesLoginStart($event)"><br>\r\n      <span id="notes-login-btn" style="cursor:pointer" ng-click="logIn()">{{NotesloginButton}}</span><br>\r\n      <div id="notes-login-info">\r\n        {{notesLoginInfo}}\r\n      </div>\r\n    </form>\r\n  </div>\r\n  <div id="note-list" ng-if="!signedOut && notesPanelOnStage">\r\n    <section class="page-note-area" ng-if="notesPanelOnStage">\r\n      <h3>{{txtNotePanelPageNotes}}</h3>\r\n      <table style="width:100%">\r\n        <tr style="border-bottom:1px solid #f3e868;" ng-repeat="note in userNotes | orderBy : \'createdDate\' : true"  ng-if="note.page == current.article || note.page == spread.article">\r\n          <td style="width:10%; text-align:left; cursor:pointer; padding-left: 10px;" ng-click="noteJump(note.page * 1)">\r\n            <span class="note-list-style-{{note.style}}">&nbsp;</span>\r\n          </td>\r\n           <td style="width:60%; padding-left: 10px;">\r\n             <span ng-if="note.id == noteConfirmID" ng-click="deleteNote(note.id)" style="cursor:pointer;color:#900;font-weight:bold;">Poista</span><span ng-if="note.id == noteConfirmID" ng-click="cancelDelete()" style="cursor:pointer;color:#666;font-weight:bold;"> Peruuta</span>\r\n             <span class="note-panel-note" ng-if="note.id != noteConfirmID" style="font-weight:bold;" ng-click="editNote(note)" title="{{note.content}}">{{ note.content.substr(0,15) }}</span><span ng-if="note.content.length > 20">...</span>\r\n           </td>\r\n           <td style="width:30%; text-align:right;">\r\n             <button ng-click="deleteNoteConfirm(note.id)"\r\n                     class="btn btn-sm"\r\n                     id="delete-note"\r\n                     title="poista muistiinpano">\r\n               <i class="fa fa-trash"></i>\r\n             </button>\r\n           </td>\r\n        </tr>\r\n      </table>\r\n    </section>\r\n    <section class="all-notes-area" ng-if="notesPanelOnStage">\r\n      <h3>{{txtNotePanelAllNotes}}</h3>\r\n      <table style="width:100%" style="font-size:0.8em">\r\n        <tr style="border-bottom:1px solid #ddd;" ng-repeat="note in userNotes | orderBy : \'page\'"  >\r\n           <td style="width:10%; text-align:left; cursor:pointer; padding-left: 10px;" ng-click="noteJump(note.page * 1)">\r\n             <span class="note-list-style-{{note.style}}">&nbsp;</span>\r\n           </td>\r\n           <td style="width:15%; text-align:left; cursor:pointer; padding-left: 10px;" ng-click="noteJump(note.page * 1)">\r\n             <span class="note-panel-page-number">{{ note.page }}</span>\r\n           </td>\r\n           <td style="width:60%; cursor:pointer;">\r\n              <span ng-if="note.id == noteConfirmID" ng-click="deleteNote(note.id)" style="cursor:pointer;color:#900;font-weight:bold;">Poista</span><span ng-if="note.id == noteConfirmID" ng-click="cancelDelete()" style="cursor:pointer;color:#666;font-weight:bold;"> Peruuta</span>\r\n             <span ng-if="note.id != noteConfirmID" class="note-panel-note" title="{{note.content}}" ng-click="noteJump(note.page * 1)">{{ note.content.substr(0,15) }}</span><span ng-if="note.content.length > 20">...</span>\r\n           </td>\r\n           <td style="width:15%; text-align:right;">\r\n             <button ng-click="deleteNoteConfirm(note.id)"\r\n                     class="btn btn-sm"\r\n                     id="delete-note"\r\n                     title="poista muistiinpano">\r\n               <i class="fa fa-trash"></i>\r\n             </button>\r\n           </td>\r\n        </tr>\r\n      </table>\r\n    </section>\r\n  </div>\r\n</div>\r\n'),
a.put("views/page.html",'<div class="page-container" data-article="{{page.article.index}}" data-page="{{page.index}}">\r\n  <span class="spinner" us-spinner="loading" ng-if="!loaded"></span>\r\n  <img class="magazine-page"\r\n       ng-src="{{imageUrl}}"\r\n       alt="{{page.article.title}}" />\r\n\r\n  <div class="enrichments">\r\n    <actionpoints actionpoint="actionpoint"\r\n                  ng-repeat="actionpoint in page.actionpoints" ng-if="showEnrichedContent">\r\n    </actionpoints>\r\n    <div ng-repeat="anchor in page.anchors" ng-if="showEnrichedContent">\r\n      <a anchor class="actionpoint link"\r\n         ng-class="{flash: hover, show: $root.actionpointsVisible}"\r\n         ng-mouseenter="hover = true" ng-mouseleave="hover = false"\r\n         data="anchor"\r\n         href="{{anchor.url}}"\r\n         title="{{anchor.title}}"\r\n         ></a>\r\n    </div>\r\n    <highLights ng-repeat="hl in highlights | filter: {word: pageKeyword}"\r\n      style="display:block;position:absolute;top:{{100-hl.y}}%;left:{{hl.x}}%;height:{{hl.h}}%;width:{{hl.w}}%;"\r\n      ng-if="showHighLights">\r\n    </highLights>\r\n\r\n    <favorites ng-repeat="fm in favoriteMatches | filter: {page: page.article.index}"\r\n    style="text-align:center; background-color:transparent; color:rgb(253, 197, 11); display:block;position:absolute;top:{{100-fm.y}}%;left:{{fm.x}}%;height:{{fm.h1}}%;width:{{fm.w1}}%;"\r\n    >\r\n      <i class="fa fa-star" style="color:rgb(255, 132, 16);"></i>\r\n    </favorites>\r\n    <noterecs ng-repeat="nr in noterecs | filter: {page: page.article.index}"\r\n      style="display:block;position:absolute;top:{{nr.yCoordinate}}%;left:{{nr.xCoordinate}}%;height:{{nr.height}}%;width:{{nr.width}}%;"\r\n      class="notes-{{nr.style}}"\r\n      ng-if="nr.height > 0 && nr.page == page.article.index"\r\n      >\r\n    </noterecs>\r\n  </div>\r\n  <div ng-if="drawingMode"\r\n    id="drawing-mode-canvas"\r\n    style="z-index:999999;position:absolute;top:0;width:100%;background-color:rgba(0,0,0,0.5);height:100%;cursor:default"\r\n    hm-panstart="rectangleStart($event)"\r\n    hm-panmove="rectangleScale($event)"\r\n    hm-panend="rectangleStop($event)"\r\n    ng-click="rectangleCancel($event)"\r\n  >\r\n    <div id="notes-rectangle" ng-style="noteRectanglePosition" style="display:none;background-color:rgba(255,0,0,0.2);border:2px red solid;position:absolute;width:100px;height:100px;"></div>\r\n  </div>\r\n</div>\r\n'),a.put("views/picture-modal.html",'<div ng-if="actionpoint.caption" class="modal-header">\r\n  <button type="button" ng-click="close()" class="close"><span class="close-icon" aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\r\n  <h3 class="modal-title">{{actionpoint.caption}}</h3>\r\n</div>\r\n<div class="modal-body no-padding">\r\n  <button ng-if="!actionpoint.caption" type="button" ng-click="close()" class="close positioned"><span class="close-icon" aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\r\n  <inline-carousel class="actionpoint image popup"\r\n                   ng-class=\'{"captions-below": actionpoint.captions == "below"}\' actionpoint="actionpoint">\r\n  </inline-carousel>\r\n</div>\r\n'),a.put("views/picture.html",'<div class="picture-url" ng-if="picture.gotourl">\r\n  <a href="{{gotoHref}}" target="_blank" style="color:#ccc">{{gotoText}}</a>\r\n</div>\r\n<div class="imageWrapper" ng-click="picture.zoomed = !picture.zoomed" ng-class="{\'zoomed\': picture.zoomed}">\r\n<img ng-if="!picture.src" ng-src="{{baseUrl + picture}}" alt="" />\r\n<img ng-if="picture.src" ng-src="{{baseUrl + picture.src}}" alt="{{picture.caption}}" title="{{picture.caption}}" style="max-height:{{myMaxHeight}}" />\r\n</div>\r\n<div class="carousel-caption" ng-if="picture.caption">\r\n  {{picture.caption}}\r\n</div>\r\n'),a.put("views/read-text-modal.html",'<div class="modal-header clearfix">\r\n  <button type="button" ng-click="close()" class="close"><span class="close-icon" aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\r\n  <div style="color:#000;float:left" class="share-buttons" ng-if="actionpoint.enableStorySharing">\r\n    <button\r\n    id="facebook-btn-topbar"\r\n    ng-click="shareStoryBox(\'fb\')"\r\n    class="btn btn-sm"\r\n    >\r\n      <i class="fa fa-facebook"></i>\r\n    </button>\r\n\r\n    <button\r\n    id="facebook-btn-topbar"\r\n    ng-click="shareStoryBox(\'twitter\')"\r\n    class="btn btn-sm"\r\n    >\r\n      <i class="fa fa-twitter"></i>\r\n    </button>\r\n\r\n    <button\r\n    id="facebook-btn-topbar"\r\n    ng-click="shareStoryBox(\'linkedin\')"\r\n    class="btn btn-sm"\r\n    >\r\n      <i class="fa fa-linkedin"></i>\r\n    </button>\r\n\r\n    <button\r\n    id="facebook-btn-topbar"\r\n    ng-click="shareStoryBox(\'link\')"\r\n    class="btn btn-sm"\r\n    >\r\n      <i class="fa fa-link"></i>\r\n    </button>\r\n\r\n  </div>\r\n  <div ng-if="actionpoint.fontsizetool" class="btn-group pull-right">\r\n    <button type="button" ng-click="increaseFontSize()" class="btn btn-sm btn-primary" title="Increase font size"><span class="fa fa-plus"></span></button>\r\n    <button type="button" ng-click="resetFontSize()" class="btn btn-sm btn-primary" title="Default font size"><span class="fa fa-font"></span></button>\r\n    <button type="button" ng-click="decreaseFontSize()" class="btn btn-sm btn-primary" title="Decrease font size"><span class="fa fa-minus"></span></button>\r\n  </div>\r\n  <h3 ng-if="actionpoint.caption" class="modal-title">{{actionpoint.caption}}</h3>\r\n</div>\r\n<div class="modal-body">\r\n\r\n  <div ng-if="showUrl">\r\n    <div style="text-align:center; background-color: #ccc; padding: 10px; border-radius:6px;">\r\n      <p>Kopioi linkki alta</p>\r\n      <input type="text" value={{shareUrl}} style="width: 100%; font-size:1em; border-radius:6px; border:none; text-align:center;" />\r\n    </div>\r\n  </div>\r\n  <read-text\r\n     actionpoint="actionpoint"\r\n     ng-if="actionpoint.type == \'text\' && actionpoint.appearance == \'popup\'"\r\n     ></read-text>\r\n</div>\r\n'),a.put("views/read-text.html",'<div ng-bind-html="content | trustHtml"></div>\r\n'),a.put("views/search-results.html",'<div ng-if="searchParagraphs.length > 0" style="min-height:200px;max-height:400px;max-width:600px;margin:40px;overflow:auto;background-color: rgba(255,255,255,0.9);" ng-model="keyword" >\r\n  <div ng-repeat="(key,paragraph) in searchParagraphs">\r\n    <div ng-if="paragraph.page != searchParagraphs[key - 1].page">\r\n      <div style="background-color:#ccc;text-align:center;clear:both;">\r\n        {{wordPage}} {{paragraph.page}}\r\n      </div>\r\n      <div style="float:left; width:100px; max-width:25%; padding:10px;">\r\n        <img ng-click="jumpToSearchDestination(paragraph.page*1)" ng-src="{{articles[paragraph.page-1].pages[0].thumbnail_url}}" style="width:100%;border: 1px solid;"/>\r\n      </div>\r\n      <div style="float:left; width:460px; max-width:75%; padding:10px;">\r\n        <div ng-repeat="paragraph2 in searchParagraphs | filter: {page:paragraph.page}" ng-click="jumpToSearchDestination(paragraph.page*1)"  style="margin-left:10px;" class="searchResult">\r\n          {{ paragraph2.keywordStart }}<strong>{{ paragraph2.html }}</strong>{{ paragraph2.keywordEnd }}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'),a.put("views/share-spread-modal.html",'<div class="modal-body no-padding shop-modal" style="height:{{readerHeight}}px;">\r\n  <div class="popup-header">\r\n    <button ng-if="!actionpoint.caption" type="button" ng-click="close()" class="close positioned"><span class="close-icon" aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\r\n    <h1 ng-if="mode == \'twitter\'">{{txtShareSpreadHeading}}</h1>\r\n    <h1 ng-if="mode == \'fb\'">Jaa Facebookissa</h1>\r\n    <h1 ng-if="mode == \'link\'">Kopioi linkki</h1>\r\n  </div>\r\n  <div class="share-info-box">\r\n    <p ng-if="mode == \'fb\'"> Kumman aukeaman sivun kohdalta haluat jakaa julkaisun?</p>\r\n  </div>\r\n  \r\n  <div class="share-spread-body">\r\n    <div ng-if = "1 < 0" class="share-thumbnail">\r\n      <h2>Julkaisun alusta</h2>\r\n      <img\r\n        ng-src="{{thumbnail_cover}}"\r\n        width="100px"\r\n        ng-click="share(mode, 1)"\r\n        />\r\n    </div>\r\n    <div class="share-thumbnail">\r\n      <h2>vasen sivu {{article}}</h2>\r\n      <img\r\n        ng-src="{{thumbnail_left}}"\r\n        width="100px"\r\n        ng-click="share(mode, article)"\r\n        />\r\n    </div>\r\n    <div class="share-thumbnail">\r\n      <h2>Oikea sivu {{article + 1}}</h2>\r\n      <img\r\n        ng-src="{{thumbnail_right}}"\r\n        width="100px"\r\n        ng-click="share(mode, article + 1)"\r\n        />\r\n    </div>\r\n    <div style="clear:both;"></div>\r\n  </div>\r\n    <div style="height: 200px; width:90%; margin: 0 auto 0 auto;">\r\n      <div ng-if="mode == \'link\'" style="text-align:center;">\r\n        <p>Kopioi linkki alta</p>\r\n        <input type="text" value={{shareUrl}} style="width: 100%; font-size:2em; border-radius:6px;" />\r\n      </div>\r\n      <div ng-if="mode == \'fb\'">\r\n        <div class="share-preview">\r\n          <div class="share-preview-img">\r\n            <img\r\n              ng-src="{{thumbnail_selected}}"\r\n              width="100px"\r\n              ng-click="share(mode, article)"\r\n              />\r\n          </div>\r\n          <div class="share-preview-txt">\r\n            <h2>{{pageTitle}}</h2>\r\n            <p>{{shareDescription}}</p>\r\n          </div>\r\n          <div class="share-preview-btn">\r\n            <button ng-click="share(mode, article, true)">siirry jakamaan</button>\r\n          </div>\r\n          <div style="clear:both;"></div>\r\n      </div>\r\n      </div>\r\n      <div ng-if="mode == \'linkedin\'">\r\n        <div class="share-preview">\r\n          <div class="share-preview-img">\r\n            <img\r\n              ng-src="{{thumbnail_selected}}"\r\n              width="100px"\r\n              ng-click="share(mode, article)"\r\n              />\r\n          </div>\r\n          <div class="share-preview-txt">\r\n            <h2>{{pageTitle}}</h2>\r\n            <p>{{shareDescription}}</p>\r\n          </div>\r\n          <div class="share-preview-btn">\r\n            <button ng-click="share(mode, article, true)">siirry jakamaan</button>\r\n          </div>\r\n          <div style="clear:both;"></div>\r\n      </div>\r\n      </div>\r\n    </div>\r\n\r\n  </div>\r\n</div>\r\n'),a.put("views/shop-modal.html",'<div class="modal-body no-padding shop-modal" style="height:{{readerHeight}}px;">\r\n  <div class="popup-header">\r\n    <button ng-if="!actionpoint.caption" type="button" ng-click="close()" class="close positioned"><span class="close-icon" aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\r\n    <h1>{{shopHeader}}</h1>\r\n  </div>\r\n  <div class="shop-body" style="height:{{readerHeight-30}}px;">\r\n    <iframe ng-src="{{frameUrl}}" id="shopwindow" name="shopwindow"></iframe>\r\n  </div>\r\n</div>\r\n'),a.put("views/show-html-page.html",'<iframe frameborder="0"></iframe>'),a.put("views/video-modal.html",'<div class="modal-header clearfix" ng-if="actionpoint.caption">\r\n  <button type="button" ng-click="close()" class="close"><span class="close-icon" aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\r\n  <h3 class="modal-title">{{actionpoint.caption}}</h3>\r\n</div>\r\n<div class="modal-body">\r\n  <button ng-if="!actionpoint.caption" type="button" ng-click="close()" class="close positioned"><span class="close-icon" aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\r\n\r\n  <show-video class="actionpoint video popup"\r\n    data="actionpoint"\r\n    video="actionpoint.sources[0]"\r\n    ng-if="actionpoint.type == \'video\'">\r\n  </show-video>\r\n\r\n</div>\r\n'),a.put("views/video.html",'<iframe frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen allowautoplay allow="autoplay; fullscreen; picture-in-picture; xr-spatial-tracking; encrypted-media"></iframe>\r\n\r\n<video controls loop muted="{{data.autoplay}}" autoplay="{{data.autoplay}}" webkitallowfullscreen mozallowfullscreen allowfullscreen>\r\n	<source></source>\r\n	<p>Your browser does not support HTML5 video</p>\r\n</video>\r\n')}]),function(){angular.module("app").controller("articles",["$http","$location","$timeout","$rootScope","$sce","$scope","$state","$stateParams","$modal","Fullscreen","PagePosition","PublicationContent","ViewSettings","analyticsService","configService","notesService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q,r,s,t,u,v,w,x,y,z,A;if(console.log("ARTICLES"),f.cartClass=m.cartButtonClass,f.current=k.current,f.txtCart=l.translations.cart,f.txtShopHeader=l.translations.shopHeader,f.txtCartHeader=l.translations.cartHeader,f.txtDisableActions=l.translations.disableActions,f.txtPrint=l.translations.print,f.txtToggleZoom=l.translations.toggleZoom,f.txtHighlightActionpoints=l.translations.highlightActionpoints,f.txtPage=l.translations.page,f.txtSearch=l.translations.search,f.txtToggleSpread=l.translations.toggleSpread,f.txtTogglePage=l.translations.togglePage,f.txtHelp=l.translations.help,f.txtTableOfContents=l.translations.tableOfContents,f.txtToggleNavigation=l.translations.toggleNavigation,f.txtNoteFormHeader=l.translations.noteFormHeader,f.txtNotePanelHeading=l.translations.notePanelHeading,f.txtNotePanelAllNotes=l.translations.notePanelAllNotes,f.txtNotePanelPageNotes=l.translations.notePanelPageNotes,f.txtCloseAd=l.translations.closeAd,f.txtNotesNotLoggedIn=l.translations.notesNotLoggedIn,f.showSmartAds=l.smartAdsShow,f.showFileAds=l.fileAdsShow,f.showK360Ads=l.k360AdsShow,f.pageAdsUrl=l.filePageAdsUrl,f.showPageAdsOnPage=!1,f.ads=l.pageAds,f.notesPanel=l.notesPanel,f.spread=k.spread,f.view=m,f.content=l,d.disablePopups=!1,f.notesPanelStyle={right:"0px"},f.notesPanelArrowStyle={transform:"rotate(0deg)"},f.notesPanelOnStage=!0,f.notesPanelHidden=!0,f.MenuZoomSlider=!1,f.fromPage=0,f.searchActive=!1,l.pageAdServiceUrl){f.pageAdsUrl=l.pageAdServiceUrl+"/uploads";try{a.get(l.pageAdServiceUrl+"/adsfeed.php").then(function(a){var b,c;for(b=[],c=0;c<a.data.length;)a.data[c].active&&b.push(a.data[c]),c++;return l.pageAds=b,f.ads=b})}catch(B){s=B,console.log("problem with pageads.json")}}if(l.k360AdsShow){f.pageAdsUrl2=l.k360baseUrl+"/Public/Objects/"+l.k360serviceSet+"/"+l.k360service+"/"+l.k360display+"/fi-FI?page=1&pageSize=10&sortByPublishDateDesc=false";try{a.get(f.pageAdsUrl2).then(function(a){var b,c;for(console.log(a),b=[],c=0;c<a.data.length;)a.data[c].active=!0,a.data[c].page=a.data[c].pageNumber,a.data[c].adid=a.data[c].image._1200,a.data[c].active&&b.push(a.data[c]),c++;return l.pageAds=b,f.ads=b})}catch(B){s=B,console.log("problem with pageads.json ")}}return f.toggleFavorites=function(){return m.showFavoriteModal=!m.showFavoriteModal},f.toggleMenuZoom=function(a){return l.disableMenuZoomSlider?void 0:(f.MenuZoomSlider=a,m.menuZoom=a)},f.unhideAudioPlayer=function(){return m.hideAudioPlayer=!1},f.toggleShareButtons=function(){return f.showShareButtons=!f.showShareButtons},f.shareSpread=function(a,b){var c;return console.log(l),console.log(b),c=i.open({windowClass:"note-window",templateUrl:"views/share-spread-modal.html",controller:["$scope","$modalInstance","$sce","PagePosition","PublicationContent",function(a,c,d,e,f){return console.log(b),a.thisUrl=window.location.href,a.shareUrl=window.location.href,a.selectedLinkPage=1,a.mode=b,a.txtShareSpreadHeading=f.translations.shareSpreadHeading,a.article=e.current.article,a.thumbnail_cover=f.articles[0].pages[0].thumbnail_url,a.thumbnail_left=f.articles[e.current.article-1].pages[0].thumbnail_url,a.thumbnail_right=f.articles[e.current.article].pages[0].thumbnail_url,a.thumbnail_selected=f.articles[e.current.article].pages[0].thumbnail_url,a.pageTitle=f.pageTitle,a.shareDescription="Jaettu sivulta",a.close=function(){return c.close(),o.writingMode=!1},a.share=function(b,c,d){var g,h,i,j,k,l,m,n;return null==d&&(d=!1),console.log(e.current),m=window.location.href,i=m.replace("http://",""),i=i.replace("https://",""),i=i.replace("#","hashtag"),g=b,k=f.pageTitle,j="Jaettu sivulta "+c,h=1e5+999999*Math.random(),a.shareDescription=j,"fb"===b&&(l="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent("https://pubservices.kosila.fi/edocsharer/edocspread.php?rd="+i+"&t="+k+"&d="+j+"&p="+c+"&r="+h),a.thumbnail_selected=f.articles[c-1].pages[0].thumbnail_url,d&&window.open(l)),"linkedin"===b&&(l="https://www.linkedin.com/sharing/share-offsite/?url="+encodeURIComponent("https://pubservices.kosila.fi/edocsharer/edocspread.php?rd="+i+"&t="+k+"&d="+j+"&p="+c+"&r="+h),a.thumbnail_selected=f.articles[c-1].pages[0].thumbnail_url,d&&window.open(l)),"twitter"===b&&(n=i.replace("hashtag","%23"),l="http://twitter.com/share?text="+k+"&url="+n,window.open(l)),"link"===b&&(a.selectedLinkPage=c,a.shareUrl=a.thisUrl.split("article")[0]+"article/"+c+"/page/1-1"),event.stopPropagation(),event.preventDefault()}}]})},d.userNotes=l.userNotes,f.toggleNotes=function(){return o.writingMode=!1,f.notesPanelHidden=!f.notesPanelHidden,o.normalScrolling=!f.notesPanelHidden},f.pageNote=function(a,b,c,d,e,f){var g;return o.writingMode=!0,g=i.open({windowClass:"note-window",templateUrl:"views/note-modal.html",controller:["$scope","$modalInstance","$sce","PagePosition",function(g,h,i,j){return g.noteCoords={x:c,y:d,w:e,h:"h",h:f},g.notePage=a,g.noteSpreadPage=b,g.selectedPage=a,g.selectedStyle=1,g.txtNoteFormHeader=l.translations.noteFormHeader,g.setSelectedPage=function(a){return g.selectedPage=a},g.selectNoteStyle=function(a){return g.selectedStyle=a},g.saveNote=function(){return p.save({issue:l.notesIssueId,page:g.selectedPage,style:g.selectedStyle,xCoordinate:c,yCoordinate:d,width:e,height:f,content:g.noteArea}),h.close(),o.writingMode=!1},g.close=function(){return h.close(),o.writingMode=!1}}]})},f.pageNoteRect=function(){return f.resetZoom(),m.drawingMode=!0,m.notifyChange()},f.deleteNote=function(a){return p["delete"](a)},f.print=function(){var a;return a=window.open("print.html","eDocker_read_print","location, resizable, scrollbars, status, width=950, height=1000"),a.focus(),a.print()},f.cart=function(){var a;return a=i.open({windowClass:"cart",templateUrl:"views/shop-modal.html",controller:["$scope","$modalInstance","$sce",function(a,b,c){return a.readerHeight=m.readerHeight()-100,a.shopHeader=l.translations.cartHeader,a.frameUrl=c.trustAsResourceUrl(Content.shopBaseUrl+"/openDnBuyNow/openDnBuyNow.aspx?PubAvaaKori="+o.uuid),a.close=function(){return b.close()}}]})},f.help=function(){var a;return a=i.open({windowClass:"cart",templateUrl:"views/help-modal.html",controller:["$scope","$modalInstance","$http","$sce",function(a,b,c,d){return a.readerHeight=m.readerHeight()-100,c.get("instructions.html").then(function(b){return a.htmlContent=b.data}),a.close=function(){return b.close()}}]})},f.navWindow=function(){var a;return a=i.open({windowClass:"navWindow",templateUrl:"views/nav-modal.html",controller:["$scope","$modalInstance","PublicationContent","PagePosition",function(a,b,c,d){return a.contentParagraphs=SearchIndex.paragraphs,a.navTitle=c.translations.tableOfContents,a.pageWord=c.translations.page,a.content=Content,a.headingFilter=function(a){return a.tag===c.tocKeyWord[0]||a.tag===c.tocKeyWord[1]||a.tag===c.tocKeyWord[2]?!0:void 0},a.close=function(){return b.close()},a.navTo=function(a){return d.flipPage(a),b.close()}}]})},f.$watchCollection(function(){var a;return[f.current.article,null!=(a=f.spread)?a.article:void 0]},function(){var a;return f.showRightArrow=f.content.articles.length!==(null!=(a=f.spread.article)?a:f.current.article)}),q=function(a,b,d){var e,g,h,i;for(e=0,console.log(f.ads.length),console.log(a),console.log(b),i=[];e<f.ads.length;)console.log(f.ads[e].page),(f.ads[e].page===a||f.ads[e].page===b)&&(console.log("Osu"),f.showAdId=f.ads[e].adid,f.showSmartAds&&(h=document.getElementById("sas_"+f.showAdId).innerHTML),(f.showFileAds||f.showK360Ads)&&(h=document.getElementById("file_"+f.showAdId).innerHTML),h.indexOf("img")>0&&(f.showPageAdsOnPage=!0),g=window.innerHeight+"px",f.adPlaceHolderStyle={height:g,"background-color":"rgba(0,0,0,0.0)"},d?f.adInnerStyle={left:"70%"}:f.adInnerStyle={left:"-70%"},c(function(){return f.adPlaceHolderStyle={height:g,"background-color":"rgba(0,0,0,0.9)"},f.adInnerStyle={left:"0%"}},50)),f.adIndex=e,f.showSmartAds&&sas.cmd.push(function(){return sas.render(f.ads[f.adIndex].adid)}),i.push(e++);return i},t=function(){var a,b;for(a=l.pageAds[0].adid,b=1;b<l.pageAds.length;)a+=","+l.pageAds[b].adid,b++;return sas.cmd.push(function(){return sas.call("onecall",{siteId:l.smartAdsSiteId,pageId:l.smartAdsPageId,formatId:a,target:""})}),f.smartAdsReady=!0,q(0,0,0)},f.$on("PagePositionChanged",function(a,c,e){var g,h,i,j;return g=f.fromPage<c.article,f.fromPage=c.article,l.smartAdsShow&&f.smartAdsReady&&(f.showPageAdsOnPage=!1,q(c.article,e.article,g)),(f.showFileAds||f.showK360Ads)&&(f.showPageAdsOnPage=!1,q(c.article,e.article,g)),f.searchField=d.keyword||f.txtSearch,f.selectedArticle=f.content.articles[c.article-1],f.spreadArticle=f.content.articles[e.article-1],h=""+c.page,e.page&&(h+="-"+e.page),i="/article/"+c.article+"/page/"+h,b.path()!==i&&(d.noReload=!0,b.path(i).replace(),"undefined"!=typeof Storage&&(j=window.location.protocol+"//"+window.location.host+window.location.pathname,l.savePageNumber&&localStorage.setItem("currentPosition",JSON.stringify({url:j,current:c,spread:e})))),n.pageview(),d.favoritetoken&&l.favoritePhrases?m.showFavoriteModal=!0:void 0}),w=h.page.match(/([0-9]+)\-([0-9]+)/),w?(m.spreadEnabled=!0,r=w[1],x=w[2]):(r=h.page,x=1),k.flipPage(parseInt(h.article,10),parseInt(r,10),parseInt(x,10)),l.recalcSpreads(m.spreadEnabled,k.current,k.spread),f.$watch(function(){return m.spreadEnabled},function(a){var b;return b=f.current,a&&"right"===l.articles[b.article-1].type?k.flipPage(b.article-1,1,b.page):k.resetSpreadPage(),l.recalcSpreads(a,k.current,k.spread)}),f.article={},f.page={},f.spreadPage={},f.hasSubPages=1!==_.max(_.filter(_.pluck(f.content.articles,"length"),_.isNumber)),f.noAction=function(a){return a.stopPropagation(),a.preventDefault()},f.onSingleTap=function(a){return f.hideNavbar(),!l.doubleClickZoom&&("DIV"===a.target.nodeName||"IMG"===a.target.nodeName||m.mouseX>1)?f.onDoubleTap(a):void 0},f.toggleNavbar=function(a){return d.isNavbarVisible=!d.isNavbarVisible&&!d.isSearchVisible,a.stopPropagation(),a.preventDefault()},f.hideNavbar=function(){return d.isNavbarVisible&&(d.isNavbarVisible=!1),!1},f.searchStart=function(a){return f.searchActive=!0,a.target.select(),d.isSearchVisible=!1,a.stopPropagation(),a.preventDefault()},f.search=function(a){var b;return b=f.searchField,b.length>3?(d.isNavbarVisible=!1,d.isSearchVisible=!1,c(function(){return b===f.searchField?(d.isSearchVisible=!0,d.keyword=b):b=f.searchField},1e3)):void 0},f.searchBlur=function(a){return f.searchActive=!1},f.searchEnd=function(a){return f.searchActive=!1,a.stopPropagation(),a.preventDefault(),c(function(){return d.isSearchVisible=!1},500)},f.toggleSpread=function(a){return m.toggleSpread(),c(function(){return m.spreadEnabled||m.isMobile?f.resetZoom():f.onDoubleTap(a)},700),a.stopPropagation(),a.preventDefault()},f.toggleActionpoints=function(a){return d.actionpointsVisible=!d.actionpointsVisible,a.stopPropagation(),a.preventDefault()},f.hasFullscreen=function(){return j.apiExists()},f.toggleZoom=function(){return 1===m.zoomLevel&&(m.zoomLevel=o.zoomRatio),m.toggleZoom(),!1},f.toggleFullscreen=function(a){return m.toggleFullscreen(),a.stopPropagation(),a.preventDefault()},f.savePageCoordinates=function(){var a,b,c;return a=$(".current-page img")[0],b=a.getBoundingClientRect(),c=b,m.spreadEnabled&&1!==f.current.article&&(a=$(".current-page img")[1],c=a.getBoundingClientRect()),m.rightSide=c.right-m.windowWidth,m.leftSide=b.left},f.article.next=function(a){var b,c,d,e;return m.zoomEnabled&&!a&&m.zoomLevel>m.zoomToFit&&m.rightSide>-15?(m.offsetX+=5,e=k.translatePosition(k.current),c=5/m.zoomLevel,d=m.offsetY,$("articles").css("transition","none"),$("articles").css("transform","translate("+(-e.x+c)+"px, "+d+"px)"),void f.savePageCoordinates()):(b=m.spreadEnabled&&1!==f.current.article?f.spread||f.current:f.current,b.article<f.content.articles.length?(k.flipPage(b.article+1),m.spreadEnabled?f.resetZoom():(m.offsetY=0,m.offsetX=0)):void 0)},f.article.prev=function(a){var b,c,d,e;return m.zoomEnabled&&!a&&m.zoomLevel>m.zoomToFit&&m.leftSide<15?(m.offsetX-=5,e=k.translatePosition(k.current),c=5/m.zoomLevel,d=m.offsetY,$("articles").css("transition","none"),$("articles").css("transform","translate("+(-e.x-c)+"px, "+d+"px)"),void f.savePageCoordinates()):f.current.article>1?(b=f.current,k.flipPage(b.article-(m.spreadEnabled?2:1)),m.spreadEnabled?f.resetZoom():(m.offsetY=0,m.offsetX=0)):void 0},f.callObjectiveC=function(a){var b;b=document.createElement("IFRAME"),b.setAttribute("src","js-frame:"+a),document.documentElement.appendChild(b),b.parentNode.removeChild(b),b=null},f.isCurrent=function(a){return k.isActivePage(a)},f.page.next=function(){var a,b,c,d;return m.zoomEnabled?(c=k.translatePosition(k.current),m.offsetY-=5,a=0,b=m.offsetY-5/m.zoomLevel,$("articles").css("transition","none"),void $("articles").css("transform","translate("+(-c.x+a)+"px, "+b+"px)")):f.current.page<(null!=(d=f.content.articles[f.current.article-1])?d.length:void 0)?($("page").css("transition","0.3s"),k.setCurrentPage(f.current.page+1)):void 0},f.page.prev=function(){var a,b,c;return m.zoomEnabled?(c=k.translatePosition(k.current),m.offsetY+=5,a=0,b=m.offsetY+5/m.zoomLevel,$("articles").css("transition","none"),void $("articles").css("transform","translate("+(-c.x+a)+"px, "+b+"px)")):f.current.page>1?($("page").css("transition","0.3s"),k.setCurrentPage(f.current.page-1)):void 0},f.spreadPage.next=function(){var a;return f.spread.page<(null!=(a=f.content.articles[f.spread.article-1])?a.length:void 0)?($("page").css("transition","0.3s"),k.setSpreadPage(f.spread.page+1)):void 0},f.spreadPage.prev=function(){return f.spread.page>1?($("page").css("transition","0.3s"),k.setSpreadPage(f.spread.page-1)):void 0},f.swipeUp=function(a){var b,c;return v(a)?(b=m.isSpreadPage(a.center.x)?f.spread:f.current,b.page<(null!=(c=f.content.articles[b.article-1])?c.length:void 0)?m.isSpreadPage(a.center.x)?k.setSpreadPage(f.spread.page+1):k.setCurrentPage(f.current.page+1):k.setCurrentPage(f.current.page)):void 0},f.swipeDown=function(a){var b;return v(a)?(b=m.isSpreadPage(a.center.x)?f.spread.page:f.current.page,b>1?m.isSpreadPage(a.center.x)?k.setSpreadPage(b-1):k.setCurrentPage(b-1):k.setCurrentPage(b)):void 0},f.swipeLeft=function(a){return v(a)?f.article.next():void 0},f.swipeRight=function(a){return v(a)?f.article.prev():void 0},f.onKeyPress=function(a){if(!o.writingMode&&v(a))switch(a.keyCode){case 38:return a.preventDefault(),f.toggleMenuZoom(!1),f.page.prev();case 40:return a.preventDefault(),f.toggleMenuZoom(!1),f.page.next();case 37:return a.preventDefault(),f.toggleMenuZoom(!1),f.article.prev();case 39:return a.preventDefault(),f.toggleMenuZoom(!1),f.article.next();case 100:return a.preventDefault(),f.article.prev(!0);case 102:return a.preventDefault(),f.article.next(!0);case 78:if(f.searchActive===!1)return f.article.prev(!0);break;case 77:if(f.searchActive===!1)return f.article.next(!0);break;case 187:return m.newKeyboardZoom(.5);case 189:return m.newKeyboardZoom(-.5);case 171:return m.newKeyboardZoom(.5);case 173:return m.newKeyboardZoom(-.5);case 107:return m.newKeyboardZoom(.5);case 109:return m.newKeyboardZoom(-.5)}},v=function(a){return!d.isNavbarVisible},u=function(a){return f.$apply(function(){return f.onKeyPress(a)})},z=function(){return!m.zoomEnabled},y=function(a){return o.normalScrolling?a.stopPropagation():a.preventDefault()},f.$watch(z,function(a,b){return a?$("body").bind("touchmove",y):$("body").unbind("touchmove",y)}),A=function(a){var b;return b=a.originalEvent.deltaY,f.toggleMenuZoom(!1),b>0&&f.page.next(),0>b?f.page.prev():void 0},$("body").bind("DOMMouseScroll mousewheel onmousewheel wheel",A),$("body").bind("gesturechange",y),$("body").on("keydown",u),f.$on("$destroy",function(){return $("body").off("keydown",u),$("body").unbind("touchmove",y),$("body").unbind("gesturechange",y)}),l.smartAdsShow?c(function(){return t()},50):void 0}])}.call(this),function(){var a,b;a=angular.module("app"),a.animation(".jump",function(){return{enter:function(a,b){return $(a).find("page").velocity({opacity:[1,0]},{duration:500,complete:b}),function(){}},leave:function(a,b){return $(a).find("page").velocity({opacity:[0,1]},{duration:500,complete:b}),function(){}}}}),b={left:{enter:{translateX:[0,-100]},leave:{translateX:[100,0]}},right:{enter:{translateX:[0,100]},leave:{translateX:[-100,0]}},up:{enter:{translateY:[0,"-100"]},leave:{translateY:["100",0]}},down:{enter:{translateY:[0,"100"]},leave:{translateY:["-100",0]}}},a.animation(".page-transition",["ViewSettings",function(a){var c;return c=function(c,d){var e;return e=_.extend({},b[c][d]),null==e.translateX&&(e.translateX=[0,0]),null==e.translateY&&(e.translateY=[0,0]),a.spreadEnabled&&(e.translateX=e.translateX.map(function(a){return 2*a})),e.translateX=e.translateX.map(function(a){return""+a+"%"}),e.translateY=e.translateY.map(function(a){return""+a+"%"}),e},{beforeAddClass:function(a,b,d){var e,f;return"ng-hide"===b?(e=a.parent().attr("data-transition-direction"),f=c(e,"leave"),$(a).transition({x:f.translateX[0],y:f.translateY[0]},{duration:1e3,easing:"ease-in-out",complete:d})):d(),null},beforeRemoveClass:function(a,b,d){var e,f;return"ng-hide"===b?(e=a.parent().attr("data-transition-direction"),f=c(e,"enter"),a.css({transform:"translate("+f.translateX[1]+", "+f.translateY[1]+")"}),d(),$(a).transition({x:f.translateX[0],y:f.translateY[0]},{duration:1e3,easing:"ease-in-out"})):d(),null}}}]),a.animation(".slide-down-left",function(){return{enter:function(a,b){return a.css({zIndex:2}),$(a).find(".magazine-page-left").velocity({translateY:[0,"2000px"],opacity:[1,0]},{duration:500,complete:b}),function(){}},leave:function(a,b){return a.css({zIndex:1}),$(a).find(".magazine-page-left").velocity({translateY:["-2000px",0],opacity:[0,1]},{duration:500,complete:b}),function(){}}}}),a.animation(".slide-up-left",function(){return{enter:function(a,b){return a.css({zIndex:2}),$(a).find(".magazine-page-left").velocity({translateY:[0,"-2000px"],opacity:[1,0]},{duration:500,complete:b}),function(){}},leave:function(a,b){return a.css({zIndex:1}),$(a).find(".magazine-page-left").velocity({translateY:["2000px",0],opacity:[0,1]},{duration:500,complete:b}),function(){}}}}),a.animation(".slide-down-right",function(){return{enter:function(a,b){return a.css({zIndex:2}),$(a).find(".magazine-page-right").velocity({translateY:[0,"1000px"],opacity:[1,0]},{duration:500,complete:b}),function(){}},leave:function(a,b){return a.css({zIndex:1}),$(a).find(".magazine-page-right").velocity({translateY:["-2000px",0],opacity:[0,1]},{duration:500,complete:b}),function(){}}}}),a.animation(".slide-up-right",function(){return{enter:function(a,b){return a.css({zIndex:2}),$(a).find(".magazine-page-right").velocity({translateY:[0,"-2000px"],opacity:[1,0]},{duration:500,complete:b}),function(){}},leave:function(a,b){return a.css({zIndex:1}),$(a).find(".magazine-page-right").velocity({translateY:["2000px",0],opacity:[0,1]},{duration:500,complete:b}),function(){}}}}),a.directive("disableNgAnimate",["$animate",function(a){return{restrict:"A",link:function(b,c){return a.enabled(!1,c)}}}])}.call(this),function(){angular.module("app").directive("actionpoints",["$modal","analyticsService","$http","ViewSettings","configService","PagePosition","PublicationContent",function(a,b,c,d,e,f,g){return{restrict:"E",scope:{actionpoint:"="},templateUrl:"views/actionpoints.html",
link:function(e,h,i){return e.preventDragging=function(a){return a.preventDefault?a.preventDefault():void 0},e.openVideoModal=function(c){var d,e,f;return e="video",d="page "+("000"+c.articleIndex).slice(-4)+";video ",b.event(Content.title,e,d),f=a.open({windowClass:c.type,templateUrl:"views/video-modal.html",controller:["$scope","$modalInstance",function(a,b){return a.actionpoint=c,a.close=function(){return b.close()}}]})},e.openAudioPlayer=function(a){var c,e,f;return d.turnOffAudio(),d.hideAudioPlayer=!1,c=a.audioUrl,d.currentActionPoint=a,f="audio",e="page "+("000"+a.articleIndex).slice(-4)+";audio ",b.event(Content.title,f,e),d.activeAudioFile=c,d.showAudioPlayer=!0},e.openIframeModal=function(b){var c,e;return c=b.url,e=a.open({windowClass:b.type,templateUrl:"views/iframe-modal.html",controller:["$scope","$modalInstance","$sce",function(a,c,e){return a.iframeHeight=d.readerHeight()-50+"px",a.actionpoint=b,a.iframeUrl=e.trustAsResourceUrl(b.url),a.close=function(){return c.close()}}]})},e.openTextModal=function(e){var h,i;return e.hasOwnProperty("enableStorySharing")||(e.enableStorySharing=g.enableStorySharing),e.title="storyBox",e.someUid=e.sources[0].split("/")[2]+e.dimensions[0]+""+e.dimensions[1]+e.dimensions[2]+e.dimensions[3],e.hasOwnProperty("label")||(e.label=e.sources[0]),h="page "+("000"+e.articleIndex).slice(-4)+";"+e.label,b.event(Content.title,e.title,h),i=a.open({windowClass:e.type,templateUrl:"views/read-text-modal.html",controller:["$scope","$modalInstance",function(a,b){return a.actionpoint=e,a.close=function(){return b.close()},a.increaseFontSize=d.increaseFontSize,a.decreaseFontSize=d.decreaseFontSize,a.resetFontSize=d.resetFontSize,a.shareStoryBox=function(b){var d,h,i,j,k,l,m,n,o,p;return j=f.current.article,j=e.articleIndex,o=window.location.href,a.shareUrl=o.split("article")[0]+"article/"+j+"/page/1-1/modal/"+e.someUid,h=o.replace("http://",""),h=h.replace("https://",""),h=h.replace("#","hashtag"),d=b,k=g.pageTitle,m=g.someDescription,i="Jaettu sivulta "+j,"fb"===b&&c.get(e.sources[0]).then(function(a){var b,c,d,f,l,m,n,o;return n=a.data,c=n.indexOf("<h1>"),b=n.indexOf("</h1>"),o=n.substring(c,b),i=g.someDescription,i=i.replace("&"," "),f="",n.indexOf("src=")>1&&(d=n.indexOf("src=")+5,f=n.substring(d,1e3),f=f.split("'")[0]),k=o.replace("<h1>",""),k=k.replace(/(<([^>]+)>)/gi,""),console.log(k),console.log(i),l="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent("https://pubservices.kosila.fi/edocsharer/edocspread.php?rd="+h+"&t="+k+"&d="+i+"&p="+j+"&uid="+e.someUid+"&imgurl="+f),(Content.storyBoxShareBaseUrl="this")&&(m=e.someUid.split(".txt")[0]+".txt",l="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent("https://pubservices.kosila.fi/edocsharer/edocspread.php?rd="+h+"&t="+k+"&d="+i+"&p="+j+"&uid="+m+"&imgurl="+f+"&paywall=true")),window.open(l)}),"linkedin"===b&&c.get(e.sources[0]).then(function(a){var b,c,d,f,l,m,n,o;return n=a.data,c=n.indexOf("<h1>"),b=n.indexOf("</h1>"),o=n.substring(c,b),i=g.someDescription,i=i.replace("&"," "),f="",n.indexOf("src=")>1&&(d=n.indexOf("src=")+5,f=n.substring(d,1e3),f=f.split("'")[0]),k=o.replace("<h1>",""),k=k.replace(/(?:\r\n|\r|\n)/g,""),k=k.replace(/(<([^>]+)>)/gi,""),console.log(k),console.log(i),l="https://www.linkedin.com/sharing/share-offsite/?url="+encodeURIComponent("https://pubservices.kosila.fi/edocsharer/edocspread.php?rd="+h+"&t="+k+"&d="+i+"&p="+j+"&uid="+e.someUid+"&imgurl="+f),(Content.storyBoxShareBaseUrl="this")&&(m=e.someUid.split(".txt")[0]+".txt",l="https://www.linkedin.com/sharing/share-offsite/?url="+encodeURIComponent("https://pubservices.kosila.fi/edocsharer/edocspread.php?rd="+h+"&t="+k+"&d="+i+"&p="+j+"&uid="+m+"&imgurl="+f)),window.open(l)}),"twitter"===b&&(p=h.replace("hashtag","%23"),Content.storyBoxShareBaseUrl&&(console.log("StoryBoxShareBaseUrl  Found"),p=Content.storyBoxShareBaseUrl+"/sharedstory.html?story="+e.someUid),(Content.storyBoxShareBaseUrl="this")&&(n=e.someUid.split(".txt")[0]+".txt",p=o.split("#/article")[0]+"sharedstory.html?story="+n),l="http://twitter.com/share?text="+k+"&url="+p,window.open(l)),"link"===b&&(Content.storyBoxShareBaseUrl&&(console.log("StoryBoxShareBaseUrl  Found"),a.shareUrl=Content.storyBoxShareBaseUrl+"/sharedstory.html?story="+e.someUid),(Content.storyBoxShareBaseUrl="this")&&(n=e.someUid.split(".txt")[0]+".txt",a.shareUrl=o.split("#/article")[0]+"sharedstory.html?story="+n),a.showUrl=!0),event.stopPropagation(),event.preventDefault()}}]})},e.openPictureModal=function(c){var d,e,f;return c.hasOwnProperty("label")||(c.label=c.sources[0].src),e="imageSet",d="page "+("000"+c.articleIndex).slice(-4)+";img "+c.label,b.event(Content.title,e,d),f=a.open({windowClass:c.fitting+" "+c.type,templateUrl:"views/picture-modal.html",controller:["$scope","$modalInstance",function(a,b){return a.actionpoint=c,a.interval=15e3,a.close=function(){return b.close()}}]})},e.openShopModal=function(e){var f,h,i,j;return j=g.translations.shopHeader,h="productSheet",f="page "+("000"+e.articleIndex).slice(-4)+";shop "+e.productId+" ; "+e.dealerId,b.event(Content.title,h,f),i=a.open({windowClass:e.type,templateUrl:"views/shop-modal.html",resolve:{shopHeader:function(){return j}},controller:["$scope","$sce","$modalInstance","configService","shopHeader",function(a,b,f,g,h){return console.log(g.uuid),a.shopHeader=h,a.handleEvent=function(){return a.close()},window.addEventListener("message",a.handleEvent),a.readerHeight=d.readerHeight()-100,a.frameUrl=b.trustAsResourceUrl(e.url+"?PubTunniste="+g.uuid+"&PubKauppiasID="+e.dealerId+"&PubTuotekoodi="+e.productId),a.actionpoint=e,a.close=function(){var a,b;return b=g.uuid,f.close(),a={method:"post",url:"http://neptunus.kpk.fi/tarviketukku/openDnBuyNow/dnPubShopCart.aspx?oTunniste=ib8noqx_1kz65t2y&oAsiakas="+g.uuid,headers:{"Content-Type":"text/xml"}},console.log(g.uuid),c(a).then(function(a){var b;try{if(console.log(a),a.data.Tilaus.length>0)return d.changeCart()}catch(c){return b=c,console.log("ei tilausta")}})}}]})}}}}])}.call(this),function(){angular.module("app").directive("anchor",["ViewSettings",function(a){return{restrict:"A",scope:{data:"="},link:function(b,c,d){var e,f;return e=b.data,f=function(a){return!!a.match(/^((https?|file):)?\/\//)},f(e.url)&&(c.attr("target",e.url),c.addClass("external-link")),c.addClass("content-link").css(a.localToCssPosition(e))}}}])}.call(this),function(){angular.module("app").directive("articles",["ViewSettings","$rootScope","PublicationContent","$timeout","PagePosition","Functional",function(a,b,c,d,e,f){return{restrict:"E",link:function(g,h,i){var j,k;return g.zoomRange=1,j=function(a,b){var c;return c=e.translatePosition(a).x,$(h).css({transition:"0.5s",transform:"translate("+-c+"px, 0)"})},b.$on("ViewSettingChange",function(){return j(e.current,e.spread)}),k=function(c){return!b.isNavbarVisible&&e.canMove(c.direction,a.isSpreadPage(c.center.x))},g.mouseMoved=function(b){var d,f,g;return a.zoomLevel>1&"drag"!==c.panning&!a.zoomSlider&&(d=a.mouseX-b.clientX,f=a.mouseY-b.clientY+a.offsetY,a.mouseX>0&Math.abs(d)+Math.abs(f)>10&&(h.css("transition","none"),g=e.translatePosition(e.current),h.css("transform","translate("+(-g.x+.8*d)+"px, "+.8*f+"px)")),0===a.mouseX)?(a.mouseX=b.clientX,a.mouseY=b.clientY):void 0},g.adDrag=function(a){var b;return b=window.innerHeight+"px",a.deltaX<-100&&(g.adInnerStyle={height:b,left:"-100%"},g.adPlaceHolderStyle={height:b,"background-color:":"rgba(0,0,0,0)"},d(function(){return g.showPageAdsOnPage=!1},500)),a.deltaX>100?(g.adInnerStyle={height:b,left:"100%"},g.adPlaceHolderStyle={height:b,"background-color:":"rgba(0,0,0,0)"},d(function(){return g.showPageAdsOnPage=!1},500)):void 0},g.dragStart=function(b){var c;return a.pinchStarted?!1:(g.toggleMenuZoom(!1),b.preventDefault?b.preventDefault():b.returnValue=!1,c=!1,g.dragAxis=b.direction&Hammer.DIRECTION_VERTICAL&c?"vertical":"horizontal",g.dragging=!0,$("page").css("transition-property","none"),$("pages").css("transition-property","none"),h.css("transition-property","none"),!1)},g.drag=function(b){var d,i,j,k,l,m,n;if(a.zoomSlider||a.drawingMode||a.pinchStarted)return!1;if(a.zoomEnabled)return n=e.translatePosition(e.current),j=1*b.deltaX/a.zoomLevel,k=a.offsetY+b.deltaY/a.zoomLevel,h.css("transform","translate("+(-n.x+j)+"px, "+k+"px)"),!1;switch(g.dragAxis){case"vertical":d=a.isSpreadPage(b.center.x)&&e.spread.article?e.spread:e.current,l=angular.element(".page-container[data-article="+d.article+"][data-page="+d.page+"]").parents("page"),m=b.deltaY<0?angular.element(".page-container[data-article="+d.article+"][data-page="+(d.page+1)+"]").parents("page"):angular.element(".page-container[data-article="+d.article+"][data-page="+(d.page-1)+"]").parents("page"),n=e.translatePosition(d),i=(c.articles[d.article-1].length-1)*a.windowHeight,k=f.clip(n.y-b.deltaY,0,i),l.css("transform","translate(0, "+1.5*b.deltaY+"px)"),m.css("transform","translate(0, "+1.5*b.deltaY+"px)");break;case"horizontal":n=e.translatePosition(e.current),j=b.deltaX,h.css("transform","translate("+(-n.x+1*j)+"px, 0)")}return!1},g.dragEnd=function(b){if(!g.dragging||a.drawingMode||a.pinchStarted)return!1;switch(a.offsetX=a.offsetX-1*b.deltaX/a.zoomLevel,a.offsetY=a.offsetY+1*b.deltaY/a.zoomLevel,g.dragging=!1,g.dragAxis){case"vertical":a.zoomLevel<1.1&&(a.offsetX=0,a.offsetY=0,$("pages").css("transition","0.3s"),Math.abs(b.deltaY)>a.readerHeight()*a.swipeThreshold?b.deltaY>0?g.swipeDown(b):b.deltaY<0?g.swipeUp(b):e.setCurrentPage(g.current.page):e.setCurrentPage(g.current.page));break;case"horizontal":a.zoomLevel<1.1&&(a.offsetX=0,a.offsetY=0,h.css("transition","0.3s"),Math.abs(b.deltaX)>.15*a.windowWidth||b.deltaTime<400?b.deltaX>0&&g.current.article>1?g.swipeRight(b):b.deltaX<0&&g.current.article<g.content.articles.length?g.article.next():j(e.current,e.spread):j(e.current,e.spread))}return!1},b.$on("PagePositionChanged",function(a,b,f){return j(b,f),d(function(){return c.recalcActive(e.current,e.spread)},500)}),c.recalcActive(e.current,e.spread),j(e.current,e.spread)}}}])}.call(this),function(){angular.module("app").directive("audioPlayer",["ViewSettings","Url","$location",function(a,b,c){return{restrict:"E",templateUrl:"views/audio-player.html",link:function(b,c,d){var e,f;return f=b.data,e=a.activeAudioFile,b.playerTopMargin=a.actionBarHeight,b.heading1=a.currentActionPoint.heading1,b.heading2=a.currentActionPoint.heading2,"autoaudio"===a.currentActionPoint.appearance&&(a.hideAudioPlayer=!0),c.find("source").attr({src:a.activeAudioFile,type:"audio/mp3"}),b.hideAudioPlayer=function(){return a.hideAudioPlayer=!0},b.closeAudioPlayer=function(){return a.showAudioPlayer=!1}}}}])}.call(this),function(){angular.module("app").directive("favoritesModal",["$rootScope","favoriteService","ViewSettings","PublicationContent","PagePosition",function(a,b,c,d,e){return{restrict:"E",templateUrl:"views/favorites-modal.html",link:function(f,g,h){var i;return i=f.data,f.ModalTopMargin=c.actionBarHeight,f.readerHeight=c.readerHeight(),console.log("HEIGHT:"+c.readerHeight),f.heading1="Suosikkisi",f.heading2="pätäpätä",f.allFavoriteItems=[{name:"SARAN SALSA"},{name:"SKUUPPI"},{name:"SYLVIINA"},{name:"LILIAN ROLS",page:1,x:68.9,y:93.5,w:5.8,h:18.9},{name:"ARCTIC LOVER",page:1,x:68.9,y:93.5,w:5.8,h:18.9},{name:"REISU-METTE",page:1,x:68.9,y:88.7,w:6.3,h:18.9},{name:"VIHJEEN VILMA",page:1,x:68.9,y:83.9,w:7.2,h:18.9},{name:"RILENTO",page:1,x:68.9,y:79.1,w:4,h:18.9},{name:"KULTAPOSTI",page:1,x:68.9,y:74.2,w:5.6,h:18.9},{name:"VILLITUISKU",page:1,x:68.9,y:69.4,w:5.7,h:18.9},{name:"VOSMARI",page:1,x:68.9,y:63.9,w:4.5,h:18.9},{name:"VIIMAVIRTA",page:1,x:68.9,y:59.1,w:5.5,h:18.9},{name:"AAMULENTO",page:1,x:68.9,y:54.3,w:6,h:18.9},{name:"HELMERINA",page:1,x:68.9,y:49.5,w:5.6,h:18.9},{name:"KOPSU",page:1,x:68.9,y:44.6,w:3.1,h:18.9},{name:"MASAVESA",page:1,x:68.9,y:39.8,w:5.3,h:18.9},{name:"ELEVIS",page:1,x:68.9,y:35,w:3.1,h:18.9},{name:"BRILLIANT BELUS",page:2,x:6.4,y:108,w:8.1,h:18.9},{name:"STONEISLE QUINLAN",page:2,x:6.4,y:103,w:9.8,h:18.9},{name:"GINGER HOSS",page:2,x:6.4,y:97.9,w:6.6,h:18.9},{name:"PRINCIPESSA",page:2,x:6.4,y:92.9,w:6.2,h:18.9},{name:"GIGOLO BEAN",page:2,x:6.4,y:87.9,w:6.7,h:18.9},{name:"CHARMING OLIVER",page:2,x:6.4,y:82.9,w:9.1,h:18.9},{name:"EMMI FASTBACK",page:2,x:6.4,y:77.9,w:7.8,h:18.9},{name:"MERCILESS CAT",page:2,x:6.4,y:72.9,w:7.4,h:18.9},{name:"R.R. ELMER",page:2,x:6.4,y:67.8,w:5.3,h:18.9}],a.myFavoriteItems=[],a.favoriteMatches=[],f.showFavoriteSelections=!1,f.toggleFavoriteSelections=function(){return f.showFavoriteSelections=!f.showFavoriteSelections,f.updateUnselected()},f.articles=d.articles,f.jumpToFavoriteDestination=function(b){return a.direction="jump",e.flipPage(parseInt(b,10))},f.selectPhrase=function(){return b.add(this.item),f.updateUnselected()},f.deSelectPhrase=function(){return b["delete"](this.item),f.updateUnselected()},f.unselectedFavoriteItems=[],f.$watch("$root.favoriteMatches",function(){return f.favoriteMatches=a.favoriteMatches}),f.updateUnselected=function(){var a,b,c,d,e,g,h,i,j,k,l;for(f.unselectedFavoriteItems=[],j=f.allFavoriteItems,l=[],b=e=0,h=j.length;h>e;b=++e){for(a=j[b],f.addThis=!0,k=f.myFavoriteItems,c=g=0,i=k.length;i>g;c=++g)d=k[c],d.name===a.name&&(f.addThis=!1);f.addThis?l.push(f.unselectedFavoriteItems.push(f.allFavoriteItems[b])):l.push(void 0)}return l},f.closeFavoriteModal=function(){return c.showFavoriteModal=!1},f.login=function(){return b.logIn("5015826","13720")},b.get(),f.updateUnselected()}}}])}.call(this),function(){angular.module("app").directive("contentLink",["ViewSettings",function(a){return{restrict:"A",scope:{data:"="},link:function(b,c,d){var e;return e=b.data,(null!=e?e.dimensions:void 0)?c.addClass("content-link").css(a.localToCssPosition(e.dimensions)):void 0}}}])}.call(this),function(){angular.module("app").directive("inlineCarousel",["configService","ViewSettings",function(a,b){return{restrict:"E",scope:{actionpoint:"="},templateUrl:"views/inline-carousel.html",link:function(c,d,e){var f,g;return c.interval=a.carouselSpeed,g=c.actionpoint,(null!=g?g.dimensions:void 0)&&(f=b.localToCssPosition(g.dimensions),d.css({width:f.width,height:f.height}),"inline"===(null!=g?g.appearance:void 0))?d.css({position:f.position,left:f.left,top:f.top}):void 0}}}])}.call(this),function(){angular.module("app").directive("loadIndicator",function(){return{restrict:"E",scope:{content:"="},templateUrl:"views/load-indicator.html",link:function(a,b,c){}}})}.call(this),function(){angular.module("app").directive("navbar",["PublicationContent",function(a){return{restrict:"E",templateUrl:"views/navbar.html",link:function(b,c,d){var e;return b.articles=a.articles,e=function(a){return a.stopPropagation()},c.bind("touchmove",e),b.$on("$destroy",function(){return c.unbind("touchmove",e)})}}}])}.call(this),function(){angular.module("app").directive("searchResults",["PublicationContent","PagePosition","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"views/search-results.html",link:function(d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r;for(o=function(){return event.stopPropagation()},e.bind("touchmove",o),d.$on("$destroy",function(){return e.unbind("touchmove",o)}),d.jumpToSearchDestination=function(a){return c.direction="jump",b.flipPage(parseInt(a,10)),c.isSearchVisible=!1},d.articles=a.articles,m=[],r=SearchIndex.paragraphs,h=p=0,q=r.length;q>p;h=++p)g=r[h],l=g.text.toLowerCase().indexOf(d.searchField.toLowerCase()),l>=0&&(j=d.searchField.length,k=g.text.substring(l-30,l),i=g.text.substring(l+j,l+j+30),n=angular.copy(g),m.push(n),m[m.length-1].keywordStart=k,m[m.length-1].keywordEnd=i,m[m.length-1].html=d.searchField);return d.searchParagraphs=m,d.wordPage=a.translations.page}}}])}.call(this),function(){angular.module("app").directive("navbarPage",["ViewSettings","PagePosition","$rootScope","$location",function(a,b,c,d){return{restrict:"E",scope:{page:"="},templateUrl:"views/navbar_page.html",link:function(a,d,e){return a.jumpToPage=function(){return b.isCurrentPage(a.page)?void 0:(c.direction="jump",b.flipPage(a.page.article.index,a.page.index))},a.titleAttribute=function(a,b,c){return _.filter([a,"section "+b,"page "+c]).join(" — ")},a.isCurrentOrSpread=function(){return b.isActivePage(a.page)}}}}])}.call(this),function(){angular.module("app").directive("notesPanel",["configService","$modal","notesService","PagePosition","PublicationContent","$rootScope","$timeout",function(a,b,c,d,e,f,g){return{restrict:"E",templateUrl:"views/notes-panel.html",link:function(h,i,j){return h.notesLoginInfo=c.info(),h.NotesloginButton="Kirjaudu",h.noteConfirmID=0,h.$watch("$root.notesLoggedIn",function(){return f.notesLoggedIn&&c.get(e.notesIssueId),h.signedOut=e.notesDatabase&&!f.notesLoggedIn}),h.toggleNotePanel=function(){return h.notesPanelOnStage=!h.notesPanelOnStage,h.notesPanelOnStage?(a.normalScrolling=!0,h.notesPanelStyle={width:"300px","max-height":"90%"},h.notesPanelArrowStyle={transform:"rotate(0deg)"}):(a.normalScrolling=!1,h.notesPanelStyle={width:"80px",height:"120px"},h.notesPanelArrowStyle={transform:"rotate(180deg)"})},h.logIn=function(){return a.writingMode=!1,h.NotesloginButton="Tarkistetaan",c.logIn(h.notesEmail,h.notesPassword),g(function(){return f.notesLoggedIn?void 0:(h.notesLoginInfo=c.info(),h.NotesloginButton="Kirjaudu")},3e3)},h.noteJump=function(a){return f.direction="jump",d.flipPage(parseInt(a))},h.editNote=function(d){var f;return a.writingMode=!0,h.toggleNotePanel(),f=b.open({windowClass:"note-window",templateUrl:"views/note-modal.html",controller:["$scope","$modalInstance","$sce","PagePosition",function(a,b,f,g){return a.notePage=d.page,a.noteArea=d.content,a.selectedPage=d.page,a.selectNoteStyle=d.style,a.txtNoteFormHeader=e.translations.noteFormHeader,a.setSelectedPage=function(b){return a.selectedPage=b},a.selectNoteStyle=function(b){return a.selectedStyle=b},a.saveNote=function(){return c.save({id:d.id,issue:d.issue,page:d.page,style:a.selectedStyle,xCoordinate:d.xCoordinate,yCoordinate:d.yCoordinate,width:d.width,height:d.height,content:a.noteArea}),b.close()},a.close=function(){return b.close()}}]})},h.rectangleTool=function(){return h.notesPanelOnStage&&h.toggleNotePanel(),h.pageNoteRect()},h.deleteNoteConfirm=function(a){return h.noteConfirmID=a},h.cancelDelete=function(){return h.noteConfirmID="cancelled"},h.notesLoginStart=function(){return h.notesLoginInfo="",h.NotesloginButton="Kirjaudu",a.writingMode=!0}}}}])}.call(this),function(){angular.module("app").directive("page",["$rootScope","ViewSettings","$window","PagePosition","PublicationContent","$timeout","$http",function(a,b,c,d,e,f,g){return{restrict:"E",scope:{page:"="},templateUrl:"views/page.html",link:function(c,h,i){var j,k,l,m,n;return c.imageUrl=c.page.image_url,c.showEnrichedContent=!1,c.loaded=!1,c.showHighLights=e.highlights,c.highlights=[],c.drawingMode=b.drawingMode,c.rectangleStart=function(a){var b;return b=a.target.getBoundingClientRect(),c.pageLeft=b.left,c.pageTop=b.top,c.startx=a.center.x-a.deltaX-b.left,c.starty=a.center.y-a.deltaY-b.top,c.noteRectanglePosition={display:"block",left:c.startx+"px",top:c.starty+"px"}},c.rectangleScale=function(a){return c.movex=a.center.x-c.startx-c.pageLeft,c.movey=a.center.y-c.starty-c.pageTop,c.movex>0?c.noteRectanglePosition={left:c.startx+"px",top:c.starty+"px",width:c.movex+"px",height:c.movey+"px"}:c.noteRectanglePosition={left:c.startx+c.movex+"px",top:c.starty+"px",width:-1*c.movex+"px",height:c.movey+"px"}},c.rectangleCancel=function(a){return b.drawingMode=!1,b.notifyChange()},c.rectangleStop=function(a){var d,e,f,g;return f=Math.round(c.startx/b.pageWidth()*1e3)/10,g=Math.round(c.starty/b.pageHeight()*1e3)/10,e=Math.round(c.movex/b.pageWidth()*1e3)/10,d=Math.round(c.movey/b.pageHeight()*1e3)/10,c.$parent.pageNote(c.page.article.index,0,f,g,e,d),b.drawingMode=!1,b.notifyChange()},c.$watch("$root.userNotes",function(){return c.noterecs=a.userNotes}),j=function(){var a;try{return g.get("content/PAGEDATA/s"+c.page.article.index+"_p1.json").then(function(a){return c.highlights=a.data})}catch(b){return a=b,console.log("no indexed content in page: "+c.page.article.index)}},c.$watch("$root.keyword",function(){return c.showHighLights&&a.keyword?(c.pageKeyword=a.keyword,j()):void 0}),c.$watch("$root.favoriteMatches",function(){return c.favoriteMatches=a.favoriteMatches,console.log(c.favoriteMatches)}),l=function(){var a;return a=d.isActivePage(c.page),a&&b.hires?c.imageUrl=c.page.zoom_image_url:c.imageUrl=c.page.image_url},m=function(){},n=function(){var a,e,f,g,i,j,k,l,m,n,o,p;return g=h.find("img")[0],n=b.windowWidth,b.spreadEnabled&&"single"!==c.page.article.type&&(n/=2),m=b.windowHeight,j=g.naturalWidth,i=g.naturalHeight,l=1*n/m,f=1*j/i,k=f>l?1*n/j:1*m/i,a=n/j,b.zoomToFit=a/k*.95,o=j*k,e=i*k,p=(c.page.index-1)*m,d.spread.article===c.page.article.index&&(p=c.page.index-d.spread.page),this.spreadEnabled||d.current.article!==c.page.article.index||(p=c.page.index-d.current.page),h.find(".page-container").css({width:100*o/n+"%",height:100*e/m+"%"}),h.css("transform","translate(0, 0)"),h.css({top:p*m+"px",visibility:"visible"})},k=function(){return c.showEnrichedContent=d.isActivePage(c.page)&(!b.zoomEnabled||Content.activeOnZoom)},k(),h.find("img").one("load",function(){return n(),f(function(){return c.loaded=!0})}),c.isActivePage=function(){return d.isActivePage(c.page)},c.$watch("isActivePage()",function(a,b){return a?f(function(){return h.find(".actionpoint").addClass("flash")},1e3):void 0}),c.$on("ViewSettingChange",function(a,d){return null==d.zoomEnabled&&n(),l(),c.drawingMode=b.drawingMode}),c.$on("PagePositionChanged",function(a,b,c){return k(),n()})}}}])}.call(this),function(){angular.module("app").directive("pages",["ViewSettings","PagePosition","$rootScope",function(a,b,c){return{restrict:"E",scope:{article:"="},link:function(b,c,d){var e;return e=function(d,e){var f;return f=d.article===b.article.index?d.page-1:e.article===b.article.index?e.page-1:0,f*=a.windowHeight,c.css({transform:"translate(0px, "+-f+"px)"})}}}}])}.call(this),function(){angular.module("app").directive("readText",["$http","$rootScope","ViewSettings",function(a,b,c){return{restrict:"E",scope:{actionpoint:"="},templateUrl:"views/read-text.html",link:function(d,e,f){var g,h;return a.get(b.baseUrl+d.actionpoint.sources[0]).then(function(a){return d.content=a.data,console.log(a.data)}),g=d.actionpoint,h=function(){return event.stopPropagation()},e.bind("touchmove",h),d.$on("$destroy",function(){return e.unbind("touchmove",h)}),(null!=g?g.dimensions:void 0)&&"inline"===(null!=g?g.appearance:void 0)?e.css(c.localToCssPosition(g.dimensions)).css({overflow:"scroll"}):void 0}}}])}.call(this),function(){angular.module("app").directive("showHtmlPage",["ViewSettings",function(a){return{restrict:"E",scope:{data:"="},templateUrl:"views/show-html-page.html",link:function(b,c,d){var e,f;return e=b.data,f=function(){return event.stopPropagation()},c.bind("touchmove",f),b.$on("$destroy",function(){return c.unbind("touchmove",f)}),c.find("iframe").attr("src",b.data.url),(null!=e?e.dimensions:void 0)?c.css(a.localToCssPosition(e.dimensions)):void 0}}}])}.call(this),function(){angular.module("app").directive("showPicture",["$rootScope","ViewSettings",function(a,b){return{restrict:"E",scope:{picture:"=",actionpoint:"="},templateUrl:"views/picture.html",link:function(c,d,e){var f,g;return c.baseUrl=a.baseUrl,c.zoomed=!1,g=function(){var a,d;return c.myMaxHeight=b.readerHeight()+"px",("fit-width"===c.actionpoint.fitting||"largepopup"===c.actionpoint.fitting)&&(c.myMaxHeight="3000px"),("fit-width"===c.picture.fitting||"largepopup"===c.picture.fitting)&&(c.myMaxHeight="3000px"),d=c.picture.gotourl,d.indexOf("##")<0?(c.gotoText=d,c.gotoHref=d):(a=d.split("##"),c.gotoText=a[0],c.gotoHref=a[1])},g(),f=function(a){return a.stopPropagation(),a.stopImmediatePropagation()},d.bind("touchmove gesturechange",f),c.$on("$destroy",function(){return d.unbind("touchmove gesturechange",f)}),("undefined"!=typeof data&&null!==data?data.dimensions:void 0)?d.css(b.localToCssPosition(data.dimensions)):void 0}}}])}.call(this),function(){angular.module("app").directive("spread",["$rootScope","ViewSettings","$window","PagePosition",function(a,b,c,d){return{restrict:"E",scope:{index:"="},link:function(a,c,d){var e;return e=function(){var d;return d=a.index*b.windowWidth,c.css({left:d})},e(),a.$on("ViewSettingChange",function(a,b){return null==b.zoomEnabled?e():void 0})}}}])}.call(this),function(){angular.module("app").directive("showVideo",["ViewSettings","Url","$location",function(a,b,c){return{restrict:"E",scope:{data:"=",video:"="},templateUrl:"views/video.html",link:function(d,e,f){var g,h,i,j,k,l,m,n;return i=d.data,h=function(a,c){var d;return null==c&&(c=null),d=new b(a),"youtube"===c?d.queryParams().v||_.last(d.pathname().split("/")):_.last(d.pathname().split("/"))},j="https"===c.protocol()?"https":"http",i.youTube?d.video=""+j+"://www.youtube.com/embed/"+h(i.youTube,"youtube"):i.vimeo?d.video=""+j+"://player.vimeo.com/video/"+h(i.vimeo,"vimeo"):i.iframeUrl&&(d.video=i.iframeUrl),i.useVideoElement?(m="video",k="source",e.find("iframe").remove()):(m="iframe",k="iframe",e.find("video").remove()),e.find(k).attr({src:d.video,type:"video/mp4"}),"video"===m&&(n=$("<source>").attr({src:d.video.replace(/.mp4$/i,".webm"),type:"video/webm"}),e.find(k).last().after(n)),l=e.find(m)[0],e.on("click",function(a){return l.paused?l.play():l.pause(),!1}),(null!=i?i.contentDimensions:void 0)&&"popup"===(null!=i?i.appearance:void 0)&&(g=a.localToCssPosition(i.contentDimensions)),(null!=i?i.dimensions:void 0)&&"inline"===(null!=i?i.appearance:void 0)?(g=a.localToCssPosition(i.dimensions),e.css(g)):void 0}}}])}.call(this),function(){angular.module("app").directive("zoomArea",["analyticsService","ViewSettings","Functional","configService","PagePosition","$timeout","$window",function(a,b,c,d,e,f,g){return{restrict:"A",link:function(h,i,j){var k,l,m,n,o,p,q,r,s,t,u,v,w;return q=i.find(".articles-wrapper"),m=q[0],k=i.find("articles"),l=d.zoomRatio||2,r=d.zoom1,s=d.zoom2,n={x:0,y:0},v=0,w=0,h.zoomSlider=b.zoomSlider,u=0,h.toggleZoomSlider=function(a){return b.zoomSlider=a,a?(h.zoomRange=3,i.find(".zoomer").css({display:"block",left:v-100+"px",top:w+20+"px"})):i.find(".zoomer").css({display:"none"}),!0},t=function(a){return c.clip(b.zoomLevel*a,1,6)},p=function(a,c,d,g,i,j){var l,m,n;h.zoomRange=i,i>1?(b.zoomEnabled=!0,b.swapImage("hires"),h.toggleMenuZoom(!0)):(b.zoomEnabled=!1,b.swapImage("lores")),n=e.translatePosition(e.current),l=d/i,m=b.offsetOnStartY+g/i,0===d||j||(b.offsetX=b.offsetX-1*d,b.offsetY=b.offsetY+1*g),j?(k.css({transition:"none"}),k.css("transform","translate("+(-n.x+l)+"px, "+m+"px)"),0===b.lastPinchX&&q.css({transition:"none","transform-origin":""+b.trOrigX+"px "+b.trOrigY+"px"}),q.css({transition:"none",transform:"scale("+i+")"})):(b.offsetY=0,b.offsetX=0,k.css({transition:"none"}),q.css({transition:"none","transform-origin":""+a+"px "+c+"px"}),f(function(){return q.css({transition:"0.3s",transform:"scale("+i+")"})},100))},o=function(a,b){return{x:(a+i.scrollLeft())/zoom,y:(b+i.scrollTop())/zoom}},h.onPinchStart=function(c){var d,e;return c.preventDefault(),b.pinchStarted=!0,b.zoomLevelOnStart=b.zoomLevel,b.offsetOnStartX=b.offsetX,b.offsetOnStartY=Math.round(b.offsetY),b.showOnStartY=b.offsetOnStartY,b.showDeltaY=" current "+b.offsetY,b.zoomEnabled||(b.trOrigX=c.center.x,b.trOrigY=c.center.y),b.zoomEnabled=!0,1===b.zoomLevel&&(e="pinch",d=h.current.article,h.current.article>1&&b.spreadEnabled?(c.center&&c.center.x/b.windowWidth<.5&&(d=h.current.article,e="right",c.center.x/b.windowWidth<.25&&(e="left")),c.center&&c.center.x/b.windowWidth>.5&&(d=h.current.article+1,e="left",c.center.x/b.windowWidth>.75&&(e="right"))):e=c.center&&c.center.x/b.windowWidth<.5?"left":"right",a.event(Content.title,"zoom","page "+("000"+d).slice(-4)+";Pinch zoom;"+e)),!1},h.onPinch=function(a){var c,d,e;return e=a.scale*b.zoomLevelOnStart,1>e&&(e=1),e>5&&(e=5),b.zoomLevel=e,b.offsetY=Math.round(b.offsetOnStartY+a.deltaY/b.zoomLevelOnStart),c=1*a.deltaX,d=1*a.deltaY,p(0,0,c,d,e,!0),!1},h.onPinchEnd=function(a){var c;return c=a.scale*b.zoomLevelOnStart,b.lastPinchX=a.center.x,.8>c&&(c=.8),c>5&&(c=5),b.zoomLevel=c,b.offsetY=Math.round(b.offsetOnStartY+a.deltaY/b.zoomLevel),b.offsetX=b.offsetX-1*a.deltaX/b.zoomLevel,b.zoomLevel<1.1?(u=0,b.lastPinchX=0,b.zoomLevel=1,b.offsetX=0,b.offsetY=0,p(g.innerWidth/2,0,0,0,1,!0),f(function(){return b.zoomEnabled=!1},500)):(u=2,b.lastPinchX=0,b.zoomEnabled=!0),f(function(){return b.pinchStarted=!1},100),b.lastDeltaY=b.offsetY,!1},h.resetZoom=function(){return p(0,0,0,0,1),u=0,b.zoomLevel=1,b.mouseX=0,b.mouseY=0,b.offsetX=0,b.offsetY=0,b.swapImage("lores"),b.toggleZoom("off")},h.setRangeZoom=function(){var c;return 1===b.zoomLevel&&(c="slider",a.event(Content.title,"zoom","page "+("000"+h.current.article).slice(-4)+";mouse zoom;"+c)),0===v&&(v=b.windowWidth/2),b.zoomLevel=h.zoomRange,p(v,w,0,0,h.zoomRange)},h.$on("ViewSettingChange",function(a,c){return c.keyboardZoomChange?b.keyboardZoom>1.1?(b.toggleZoom("on"),v=g.innerWidth/2,w=g.innerHeight/2,p(v,w,0,0,b.keyboardZoom),b.zoomLevel=b.keyboardZoom):(h.toggleMenuZoom(!1),b.toggleZoom("off"),b.originX=0,b.originY=0,u=0,p(0,0,0,0,1),b.zoomLevel=1,b.mouseX=0,b.mouseY=0,b.offsetX=0,b.offsetY=0,b.swapImage("lores"),$("articles").css("transition","0.3s"),f(function(){return i.find(".actionpoint").addClass("flash")},500)):void 0}),h.onDoubleTap=function(c){var d,e,j,k,l,m,n,o,q,t;return k=0,l=0,q=r,t=s,1===b.zoomLevel?(n="button",j=h.current.article,h.current.article>1&&b.spreadEnabled?(c.center&&c.center.x/b.windowWidth<.5&&(j=h.current.article,n="right",c.center.x/b.windowWidth<.25&&(n="left")),c.center&&c.center.x/b.windowWidth>.5&&(j=h.current.article+1,n="left",c.center.x/b.windowWidth>.75&&(n="right"))):n=c.center&&c.center.x/b.windowWidth<.5?"left":"right",a.event(Content.title,"zoom","page "+("000"+j).slice(-4)+";mouse zoom;"+n)):u=2,2>u?(b.toggleZoom("on"),v=g.innerWidth/2,w=0,null!=c.srcEvent&&(m=c.srcEvent,v=m.clientX,w=m.clientY-b.actionBarHeight,Content.zoomSliderMouse&&h.toggleZoomSlider(!0)),null!=c.pointers&&(m=c.pointers[0],v=m.clientX,w=m.clientY-b.actionBarHeight),o=t,1===u&&(o=t,d=v-b.windowWidth/2,v=b.originX+d,b.originX=v,e=w-b.windowHeight/2,w=b.originY+e,0>w&&(w=0),b.originY=w),0===u&&(o=q,b.spreadEnabled||b.isMobile||(o=b.zoomToFit,v=b.windowWidth/2,w=0),b.originX=v,b.originY=w,k=v-b.windowWidth/2,k=-k,l=-1*w,u=2),u++,p(v,w,k,l,o),b.zoomLevel=o):(h.toggleMenuZoom(!1),b.toggleZoom("off"),b.originX=0,b.originY=0,u=0,p(v,w,0,0,1,!1),f(function(){return b.zoomEnabled=!1},500),b.zoomLevel=1,b.mouseX=0,b.mouseY=0,b.offsetX=0,b.offsetY=0,b.swapImage("lores"),$("articles").css("transition","0.3s"),f(function(){return i.find(".actionpoint").addClass("flash")},500))}}}}])}.call(this),function(){angular.module("app").filter("trustHtml",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}])}.call(this),function(){angular.module("app").factory("analyticsService",["$location","configService","PublicationContent","$http",function(a,b,c,d){return ga("create",b.googleAnalyticsId,{cookieDomain:"none",cookieFlags:"max-age=7200;secure;samesite=none"}),{pageview:function(){var b;if(ga&&ga("send","pageview",a.path()),c.comscore){self.COMSCORE&&COMSCORE.beacon({c1:"2",c2:c.comscoreID});try{return d.get("content/pageview_candidate.json?pv="+9999999*Math.random(),{headers:{"Cache-Control":"no-cache"}}).then(function(a){return console.log(a)})}catch(e){return b=e,console.log("Can't find comscores page_candidate -file")}}},event:function(a,b,e,f){var g;if(ga&&ga("send","event",a,b,e,f),c.comscore&&"stay"!==b.substring(0,4)){self.COMSCORE&&COMSCORE.beacon({c1:"2",c2:c.comscoreID});try{return d.get("content/pageview_candidate.json?ev="+9999999*Math.random(),{headers:{"Cache-Control":"no-cache"}}).then(function(a){return console.log(a)})}catch(h){return g=h,console.log("Can't find comscores page_candidate -file")}}}}}])}.call(this),function(){angular.module("app").service("configService",function(){
var a,b;return b=Content,new(a=function(){function a(){var a;this.normalScrolling=!1,this.writingMode=!1,this.googleAnalyticsId=b.googleAnalyticsId||"",this.carouselSpeed=b.carouselSpeed||5e3,this.zoomRatio=b.zoomRatio||2,this.zoom1=b.zoom1?b.zoom1:2,this.zoom2=b.zoom2?b.zoom2:this.zoomRatio,this.orientation=b.orientation||"",this.title=b.title||"",this.issue=b.issue||0,this.zoomImages=b.zoomImages||!0,this.lang=b.lang||"en",a=function(){var a;return a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},this.uuid=a()}return a}())})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};angular.module("app").service("Fullscreen",function(){var b;return new(b=function(){function b(){this.toggle=a(this.toggle,this)}return b.prototype.element=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},b.prototype.apiExists=function(){return _.any(_.map(["fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement"],function(a){return void 0!==document[a]}))},b.prototype.request=function(a){return a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):void 0},b.prototype.cancel=function(){return document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():void 0},b.prototype.toggle=function(a){return null==a&&(a=document.documentElement),this.element()?this.cancel():this.request(a)},b}())})}.call(this),function(){angular.module("app").service("Functional",function(){var a;return new(a=function(){function a(){}return a.prototype.clip=function(a,b,c){return _.min([c,_.max([b,a])])},a}())})}.call(this),function(){angular.module("app").service("PagePosition",["$rootScope","$http","analyticsService","ViewSettings","PublicationContent","$location",function(a,b,c,d,e,f){var g;return new(g=function(){function b(){this.current={article:1,page:1},this.spread={},this.pageTimer=Date.now(),this.lastPage=1}return b.prototype.resetSpreadPage=function(){var a;return a=this.current.article,d.spreadEnabled&&1!==a&&a!==e.articles.length?this.spread.article!==a+1?(this.spread.article=a+1,this.spread.page=1):void 0:(this.spread.article=null,this.spread.page=null)},b.prototype.flipPage=function(a,b,f){var g,h,i,j,k;return d.showAudioPlayer=!1,d.hideAudioPlayer=!1,d.rightSide=0,d.leftSide=0,k=Date.now()-this.pageTimer,this.pageTimer=Date.now(),k>5e3&&1e6>k&&(k>2e4?(c.event(Content.title,"Stay on page","Page "+("000"+this.lastPage).slice(-4)+";over 20",k),d.spreadEnabled&&a<e.articles.length&&c.event(Content.title,"Stay on page","Page "+("000"+(this.lastPage+1)).slice(-4)+";over 20",k)):(c.event(Content.title,"Stay on page","Page "+("000"+this.lastPage).slice(-4)+";over 5",k),d.spreadEnabled&&a<e.articles.length&&c.event(Content.title,"Stay on page","Page "+("000"+(this.lastPage+1)).slice(-4)+";over 5",k))),"left"===e.backgroundEffect&&angular.element("body").css({"background-position-x":Math.floor((a-1)/e.articles.length*100)+"%"}),j=!!f,(1>a||a>e.articles.length)&&(a=1,b=1,f=null),d.spreadEnabled?("right"===e.articles[a-1].type&&(a-=1,f=b,b=a===this.current.article?this.current.page:null),null!=e.articles[a]&&(1>f||f>e.articles[a].length)&&(f=1),(1===a||a===e.articles.length)&&(f=null)):f=null,this.lastPage=a,h=a===this.current.article,this.current.article=a,i=h&&this.current.page===b,i&&!j||!(1>b||b>e.articles[a-1].length)||(b=1),h||null!=b||(b=1),null!=b&&(this.current.page=b),h||this.resetSpreadPage(),null!=f&&(this.spread.page=f),e.sendPageToParent&&(g=new CustomEvent("edFlipPage",{detail:{c:this.current.article,s:this.spread.article}}),window.parent.document.dispatchEvent(g)),this.notify()},b.prototype.notify=function(){return a.$broadcast("PagePositionChanged",_.extend({},this.current),_.extend({},this.spread))},b.prototype.setSpreadPage=function(a){return this.spread.page=a,this.notify()},b.prototype.setCurrentPage=function(a){return this.current.page=a,this.notify()},b.prototype.isCurrentPage=function(a){return this.current.article===a.article.index&&this.current.page===a.index},b.prototype.isSpreadPage=function(a){return this.spread.article===a.article.index&&this.spread.page===a.index},b.prototype.isActivePage=function(a){return this.isCurrentPage(a)||this.isSpreadPage(a)},b.prototype.canMove=function(a,b){var c,d,f;return null==b&&(b=!1),f=function(){switch(a){case"left":case Hammer.DIRECTION_RIGHT:return this.current.article>1;case"right":case Hammer.DIRECTION_LEFT:return(this.spread.article||this.current.article)<e.articles.length;case"up":case Hammer.DIRECTION_DOWN:return b?(this.spread.page||this.current.page)>1:this.current.page>1;case"down":case Hammer.DIRECTION_UP:return c=b&&this.spread.article?this.spread:this.current,d=e.articles[c.article-1].length,c.page<d}}.call(this)},b.prototype.translatePosition=function(a){var b,c;return b=d.spreadEnabled?1===a.article?0:a.article*d.windowWidth/2+d.offsetX:(a.article-1)*d.windowWidth+d.offsetX,c=a.article===this.current.article||a.article===this.spread.article?a.page-1:0,c=c*d.windowHeight+d.offsetY,{x:b,y:c}},b}())}])}.call(this),function(){angular.module("app").service("PublicationContent",["$http","$rootScope","$timeout",function(a,b,c){var d,e;return e=function(){function a(a){this.articles=a,this.active=!1}return a}(),new(d=function(){function a(a){var c,d,e,f,g,h;if(this.favoritePhrases=[],f=window.location.search,b.baseUrl="",h=new URLSearchParams(f),h.has("serviceset")&&(g=h.get("serviceset"),d=h.get("issueobject"),b.baseUrl="https://file-dev.k360.fi/v1/Files/"+g+"/epaper/"+d+"/"),this.backgroundEffect=a.backgroundEffect,this.highlights=a.highlights,this.singlePage=a.singlePage,this.panning=a.panning,this.doubleClickZoom=a.doubleClickZoom?a.doubleClickZoom:!1,this.disableMenuZoomSlider=a.disableMenuZoomSlider===!1?!1:!0,this.minZoom=a.minZoom?a.minZoom:1,this.maxZoom=a.maxZoom?a.maxZoom:2,this.zoomSliderEnabled=a.zoomSliderEnabled?a.zoomSliderEnabled:!1,this.enableSpreadSharing=a.enableSpreadSharing,this.notesPanel=a.notesPanel,this.userNotes=a.notesDefault?a.notesDefault:[],this.notesWebStorage=a.notesWebStorage?a.notesWebStorage:!1,this.notesDatabase=a.notesDatabase?a.notesDatabase:!1,this.notesApiUrl=a.notesApiUrl?a.notesApiUrl:"",this.notesApplication=a.notesApplication?a.notesApplication:"",this.notesDevice=a.notesDevice?a.notesDevice:"",this.notesIssueId=a.notesIssueId?a.notesIssueId:"NoIssues",this.notesLoggedIn=!1,this.savePageNumber=!0,this.sendPageToParent=a.sendPageToParent?a.sendPageToParent:!1,this.searchable=SearchIndex.paragraphs.length>0,this.pageTitle=a.title?a.title:"eDocker Reader",this.smartAdsShow=a.smartAdsShow?a.smartAdsShow:!1,this.smartAdsSiteId=a.smartAdsSiteId?a.smartAdsSiteId:0,this.smartAdsPageId=a.smartAdsPageId?a.smartAdsPageId:0,this.fileAdsShow=a.fileAdsShow?a.fileAdsShow:!1,this.filePageAdsUrl=a.filePageAdsUrl?a.filePageAdsUrl:"",this.pageAdServiceUrl=a.pageAdServiceUrl?a.pageAdServiceUrl:!1,this.pageAds=a.smartAdPageAds?a.smartAdPageAds:[],this.k360AdsShow=a.k360AdsShow?a.k360AdsShow:!1,this.k360serviceSet=a.k360serviceSet?a.k360serviceSet:"",this.k360service=a.k360service?a.k360service:"",this.k360serviceSet=a.k360serviceSet?a.k360serviceSet:"",this.k360display=a.k360display?a.k360display:"",this.k360baseUrl=a.k360baseUrl?a.k360baseUrl:"",this.enableStorySharing=a.enableStorySharing?a.enableStorySharing:!1,this.someDescription=a.someDescription?a.someDescription:"",this.favoritePhrases=a.favoritePhrases?a.favoritePhrases:!1,this.favoriteDatabase=a.favoriteDatabase?a.favoriteDatabase:!1,this.favoritesApiUrl=a.favoritesApiUrl?a.favoritesApiUrl:"https://notesapi.kosila.fi",this.favoritesApplication=a.favoritesApplication?a.favoritesApplication:"",this.favoritesDevice=a.favoritesDevice?a.favoritesDevice:"",a.filePageAdsPath&&this.fileAdsShow&&(this.pageAds=a.filePageAdsPath),console.log(this.pageTitle),this.translations={page:"Page",search:"Search",cart:"Cart",cartHeader:"Custom cart header",shopHeader:"Buy product",disableActions:"Disable Actions",print:"Print",toggleZoom:"Toggle Zoom",highlightActionpoints:"Highlights Actionpoints",toggleSpread:"Spread mode",togglePage:"Single page mode",help:"Info",tableOfContents:"Table of contents",toggleNavigation:"Toggle Navigation",noteFormHeader:"Kirjoita muistiinpano",notePanelHeading:"Muistiinpanot",notePanelAllNotes:"Koko julkaisussa",notePanelPageNotes:"Tällä sivulla",shareSpreadHeading:"Jaa julkaisu sivulta",closeAd:"SULJE MAINOS",notesNotLoggedIn:"Muistiinpanoja voi käyttää vain kirjautuneena."},"FI"===a.language&&(this.translations=angular.extend(this.translations,a.translations.FI)),this.pageSize=a.pageSize,this.articles=a.articles,this.orientation=a.pageSize.width>a.pageSize.height?"landscape":"portrait",this.printable=a.printable,this.shop=a.shop,this.comscore=a.comscore,this.comscoreID=a.comscoreID,this.tocKeyWord=a.tocKeyWord?a.tocKeyWord:["h1","h2","h3"],this.spreads=[],this.lastRecalc={current:{},spread:{}},a.articles=a.articles.map(function(c,d){return c.index=d+1,c.title=c.title,c.active=!1,c.type=1===c.index?"single":c.index===a.articles.length&&c.index%2===0?"single":c.index%2===0?"left":"right",c.pages=_.times(c.length,function(e){var f;return f=a.zoomImages?"JPG_X2":"JPG",{article:c,image_url:b.baseUrl+("content/JPG/s"+c.index+"_p"+(e+1)+".jpg"),zoom_image_url:b.baseUrl+("content/"+f+"/s"+c.index+"_p"+(e+1)+".jpg"),thumbnail_url:b.baseUrl+("content/THUMBNAILS/s"+c.index+"_p"+(e+1)+"_thumb.jpg"),index:e+1,actionpoints:_.filter(c.actionpoints,function(a){return a.page===e+1&&(a.articleIndex=d+1)}),anchors:_.filter(c.anchors,function(a){return a.page===e+1&&(a.articleIndex=d+1)}),active:!1}})}),this.notesWebStorage&&"undefined"!=typeof Storage)try{e=localStorage.getItem("ednotes"),e&&(this.userNotes=JSON.parse(e))}catch(i){c=i,console.log("can't use localstorage")}}return a.prototype.getPage=function(a,b){var c;return null!=(c=this.articles[a-1])?c.pages[b-1]:void 0},a.prototype.recalcSpreads=function(a,b,c){var d,f,g,h;if(a)for(h=[],f=0,d=this.articles,g=d.length;g>f;)0===f?(h.push([d[f]]),f+=1):(f+1===g?h.push([d[f]]):h.push([d[f],d[f+1]]),f+=2);else h=this.articles.map(function(a){return[a]});return this.spreads=h.map(function(a){return new e(a)}),this.recalcActive(b,c)},a.prototype.recalcActive=function(a,b){var c;return c=(null!=b?b.article:void 0)||a.article,this.articles.map(function(d){return d.active=d.index===a.article||d.index===(null!=b?b.article:void 0)||d.index>=a.article-2&&d.index<=c+2,d.pages.map(function(e){return e.active=d.index===a.article?e.index>=a.page-1&&e.index<=a.page+1:d.index===(null!=b?b.article:void 0)?e.index>=b.page-1&&e.index<=b.page+1:1===e.index&&d.index>=a.article-2&&d.index<=c+2})}),this.spreads.map(function(a){return a.active=_.any(a.articles,function(a){return a.active})})},a}())(Content)}])}.call(this),function(){angular.module("app").factory("Url",function(){var a;return a=function(){function a(a){this.link=document.createElement("A"),this.link.href=a}return a.prototype.pathname=function(){return this.link.pathname},a.prototype.queryParams=function(){return _.object(_.reject(_.map(this.link.search.slice(1).split("&"),function(a){return a.split("=")}),function(a){return _.isEmpty(a[0])}))},a.prototype.toString=function(){return this.link.toString()},a}()})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};angular.module("app").service("ViewSettings",["$window","$rootScope","Fullscreen","PublicationContent",function(b,c,d,e){var f,g;return f=function(){function f(){this.decreaseFontSize=a(this.decreaseFontSize,this),this.increaseFontSize=a(this.increaseFontSize,this),this.localToCssPosition=a(this.localToCssPosition,this),this.spreadEnabled=this.isSpreadEnabled(),this.cartButtonClass="cartempty",this.zoomEnabled=!1,this.hires=!1,this.offsetX=0,this.offsetY=0,this.rightSide=0,this.leftSide=0,this.offsetOnStartX=0,this.offsetOnStartY=0,this.originX=0,this.originY=0,this.deltaOffsetX=0,this.deltaOffsetY=0,this.dragOffsetX=0,this.dragOffsetY=0,this.lastPinchX=0,this.menuzoom=!1,this.showDeltaY=1,this.showOnStartY=1,this.lastDeltaY=0,this.pinchStarted=!1,this.trOrigX=0,this.trorigY=0,this.zoomLevelOnStart=1,this.xCorrect=0,this.mouseX=0,this.mouseY=0,this.zoomLevel=1,this.zoomSlider=!1,this.keyboardZoom=1,this.zoomToFit=1,this.drawingMode=!1,this.actionBarHeight=30,this.swipeThreshold=.25,this.showAudioPlayer=!1,this.hideAudioPlayer=!1,this.showFavoriteModal=!1,this.activeAudioFile="",this.currentActionPoint=null,/Android|iPhone|iPad|IEMobile/i.test(navigator.userAgent)?this.isMobile=!0:this.isMobile=!1,/eDocker Reader/i.test(navigator.userAgent)?this.isNativeApp=!0:this.isNativeApp=!1,this.orientationCheck()}return f.prototype.changeCart=function(){return this.cartButtonClass="cartfilled",this.notifyChange()},f.prototype.newKeyboardZoom=function(a){return this.keyboardZoom=this.zoomLevel+a,this.keyboardZoom>e.maxZoom&&(this.keyboardZoom=e.maxZoom),this.notifyChange({keyboardZoomChange:this.keyboardZoom})},f.prototype.turnOffAudio=function(){return this.showAudioPlayer=!1,this.notifyChange()},f.prototype.readerHeight=function(){return b.innerHeight-this.actionBarHeight},f.prototype.pageWidth=function(){var a,b;return a=angular.element("body"),b=a.find(".page-container"),b[0].clientWidth},f.prototype.pageHeight=function(){var a,b;return a=angular.element("body"),b=a.find(".page-container"),b[0].clientHeight},f.prototype.isPortraitOriented=function(){return"landscape"===e.orientation?!1:!0},f.prototype.isSpreadEnabled=function(){return!e.singlePage&&this.isPortraitOriented()&&b.innerWidth>this.readerHeight()},f.prototype.orientationCheck=function(){var a,c,d;return d=this.readerHeight(),a=this.windowHeight!==d||this.windowWidth!==b.innerWidth,this.windowHeight=d,this.windowWidth=b.innerWidth,this.spreadEnabled=this.isSpreadEnabled(),a?(this.offsetY=0,this.offsetX=0,this.zoomEnabled&&(this.zoomLevel=1,this.zoomEnabled=!1,c=angular.element("body"),c.find(".articles-wrapper").css({transform:"scale(1)"})),this.notifyChange()):void 0},f.prototype.checkActionBar=function(){var a;return this.actionBarHeight=document.getElementById("topbar").clientHeight,a=angular.element("body"),a.find(".main-content").css({"padding-top":this.actionBarHeight+"px"})},f.prototype.notifyChange=function(a){return c.$broadcast("ViewSettingChange",null!=a?a:{})},f.prototype.toggleZoom=function(a){switch(null==a&&(a=null),a){case"on":this.zoomEnabled=!0;break;case"off":this.zoomEnabled=!1;break;default:this.zoomEnabled=!this.zoomEnabled}return this.notifyChange({zoomEnabled:this.zoomEnabled}),this.zoomEnabled},f.prototype.swapImage=function(a){switch(a){case"hires":this.hires=!0;break;case"lores":this.hires=!1}return this.notifyChange({zoomEnabled:this.zoomEnabled})},f.prototype.toggleSpread=function(){return this.spreadEnabled=!this.spreadEnabled,this.notifyChange()},f.prototype.toggleFullscreen=function(){return d.toggle(),this.notifyChange()},f.prototype.localToCssPosition=function(a){var b,c,d;return d=e.pageSize.width,b=e.pageSize.height,c=a instanceof Array?{position:"absolute",left:a[0]/d*100+"%",width:a[2]/d*100+"%",top:a[1]/b*100+"%",height:a[3]/b*100+"%"}:{position:"absolute",left:a.x/d*100+"%",width:a.w/d*100+"%",top:a.y/b*100+"%",height:a.h/b*100+"%"}},f.prototype.isSpreadPage=function(a){return this.spreadEnabled&&a>this.windowWidth/2},f.prototype.currentFontSize=function(){return parseInt(angular.element("body").css("fontSize"),10)||16},f.prototype.setFontSize=function(a){angular.element("body").css("fontSize",""+a+"px")},f.prototype.increaseFontSize=function(){this.setFontSize(this.currentFontSize()+1)},f.prototype.decreaseFontSize=function(){var a;a=Math.max(this.currentFontSize(),7),this.setFontSize(a-1)},f.prototype.resetFontSize=function(){angular.element("body").css("fontSize","")},f}(),g=new f,angular.element(b).one("load",function(){return console.log("wsdf"),c.$apply(function(){return g.orientationCheck(),g.checkActionBar()})}),angular.element(b).bind("resize",_.throttle(function(){return c.$apply(function(){return g.orientationCheck(),g.checkActionBar()})},100)),angular.element(b).bind("orientationchange",_.throttle(function(){return c.$apply(function(){return g.orientationCheck()})},100)),g}])}.call(this),function(){angular.module("app").factory("notesService",["$rootScope","$http","ViewSettings","PublicationContent",function(a,b,c,d){var e,f;return e="",a.notesLoggedIn=!1,f="",{info:function(){return f},setToken:function(b){return e="Bearer "+b,a.notesLoggedIn=!0},get:function(c){var f,g;return d.notesDatabase&&a.notesLoggedIn?(g=d.notesApiUrl+"/Notes?issue="+c,f={method:"get",url:g,headers:{accept:"text/plain",Authorization:e}},b(f).then(function(b){return a.userNotes=b.data,a.notesLoggedIn=!0})["catch"](function(b){return a.notesLoggedIn=!1})):void 0},save:function(f){var g,h,i,j,k;if(j=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},f.hasOwnProperty("id"))for(i=0;i<a.userNotes.length;)a.userNotes[i].id===f.id&&a.userNotes.splice(i,1),i++;if(a.userNotes.push(f),d.notesWebStorage&&(f.id=j()+j()+"-"+j()+"-"+j()+"-"+j()+"-"+j()+j()+j(),"undefined"!=typeof Storage))try{localStorage.setItem("ednotes",JSON.stringify(a.userNotes))}catch(l){h=l,console.log("can't use localstorage")}return d.notesDatabase&&(k=d.notesApiUrl+"/Notes",g={method:"post",url:k,headers:{accept:"text/plain",Authorization:e},data:f},b(g).then(function(a){})),c.drawingMode=!1,c.notifyChange()},"delete":function(c){var f,g,h,i;for(h=0;h<a.userNotes.length;)a.userNotes[h].id===c&&a.userNotes.splice(h,1),h++;if(d.notesWebStorage&&"undefined"!=typeof Storage)try{localStorage.setItem("ednotes",JSON.stringify(a.userNotes))}catch(j){g=j,console.log("can't use localstorage")}return d.notesDatabase?(i=d.notesApiUrl+"/Notes?noteId="+c,f={method:"delete",url:i,headers:{accept:"text/plain",Authorization:e}},b(f).then(function(a){return console.log(a)})):void 0},logIn:function(c,g){var h,i,j,k;return j=this,d.notesDatabase?(i={username:c,password:g,xDevice:d.notesDevice,xApplication:d.notesApplication},k=d.notesApiUrl+"/Users/authenticate",h={method:"post",url:k,headers:{accept:"text/plain"},data:i},b(h).then(function(b){var c;return c=b.data.token,e="Bearer "+c,a.notesLoggedIn=!0})["catch"](function(a){return console.log("cant log in"),f="Wrong password or username"})):void 0}}}])}.call(this),function(){angular.module("app").factory("favoriteService",["$rootScope","$http","ViewSettings","PublicationContent",function(a,b,c,d){var e,f;return e="",a.notesLoggedIn=!0,f="",{info:function(){return f},setToken:function(b){return a.token="Bearer "+b,a.notesLoggedIn=!0,c.showFavoriteModal=!0},get:function(c){var f,g;return e=a.token,console.log(a.token),d.favoriteDatabase&&a.notesLoggedIn?(g=d.favoritesApiUrl+"/favoritePhrases",f={method:"get",url:g,headers:{accept:"text/plain",Authorization:e}},b(f).then(function(c){var d;if(a.myFavoriteItems=c.data,c.data.length>0)try{return b.get("content/PAGEDATA/favoritephrases.json").then(function(b){var d,e,f;for(console.log(b),d=0,f=[];d<b.data.length;){for(e=0;e<c.data.length;)b.data[d].phrase===c.data[e].name&&(b.data[d].w1=1+Math.floor(6*Math.random()),b.data[d].h1=1+Math.floor(6*Math.random()),a.favoriteMatches.push(b.data[d])),e++;f.push(d++)}return f})}catch(e){return d=e,console.log("no indexed content in page: "+$scope.page.article.index)}})["catch"](function(a){return console.log("ERROR")})):void 0},add:function(c){var f,g,h;return g=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},c.id=g()+g()+"-"+g()+"-"+g()+"-"+g()+"-"+g()+g()+g(),a.myFavoriteItems.push(c),d.favoriteDatabase?(h=d.favoritesApiUrl+"/favoritePhrases",f={method:"post",url:h,headers:{accept:"text/plain",Authorization:e},data:c},b(f).then(function(a){return console.log(a)})):void 0},"delete":function(c){var f,g,h;for(g=0;g<a.myFavoriteItems.length;)a.myFavoriteItems[g].id===c.id&&a.myFavoriteItems.splice(g,1),g++;return d.favoriteDatabase?(h=d.favoritesApiUrl+"/favoritePhrases?favoritePhraseId="+c.id,f={method:"delete",url:h,headers:{accept:"text/plain",Authorization:e}},b(f).then(function(a){return console.log(a)})):void 0},logIn:function(c,g){var h,i,j,k;return j=this,alert("LogIn"),d.favoriteDatabase?(i={username:c,password:g,xDevice:d.favoritesDevice,xApplication:d.favoritesApplication},k=d.favoritesApiUrl+"/Users/authenticate",h={method:"post",url:k,headers:{accept:"text/plain"},data:i},b(h).then(function(b){var c;return c=b.data.token,e="Bearer "+c,a.notesLoggedIn=!0,j.get()})["catch"](function(a){return console.log("cant log in"),f="Wrong password or username"})):void 0}}}])}.call(this);